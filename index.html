<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="Engineer. Runner. Music">
<meta name="keywords" content="AI">
<meta property="og:type" content="website">
<meta property="og:title" content="风里刀">
<meta property="og:url" content="https://aimuch.com/index.html">
<meta property="og:site_name" content="风里刀">
<meta property="og:description" content="Engineer. Runner. Music">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风里刀">
<meta name="twitter:description" content="Engineer. Runner. Music">





  
  
  <link rel="canonical" href="https://aimuch.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>风里刀</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风里刀</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
      
    

    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>日程表</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



</div>
    </header>

    
  
  

  

  <a href="https://github.com/aimuch" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
        

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://aimuch.com/2019/03/26/ESXi下安装iKuai和LEDE双软路由/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andy Liu">
      <meta itemprop="description" content="Engineer. Runner. Music">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风里刀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/" class="post-title-link" itemprop="url">ESXi下安装iKuai和LEDE双软路由</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-26 14:08:17" itemprop="dateCreated datePublished" datetime="2019-03-26T14:08:17+08:00">2019-03-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-13 17:43:01" itemprop="dateModified" datetime="2019-05-13T17:43:01+08:00">2019-05-13</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/路由/" itemprop="url" rel="index"><span itemprop="name">路由</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="硬件清单"><a href="#硬件清单" class="headerlink" title="硬件清单"></a>硬件清单</h1><ul>
<li>CPU: I5 7200U</li>
<li>网卡: 6个Intel 82583V 10/100/1000以太网</li>
<li>内存: 金士顿 DDR4 2400 8G</li>
<li>SSD: 三星 EVO850</li>
<li>USB: 3.0x4个</li>
<li>电源: 技嘉12V</li>
</ul>
<h1 id="网络拓扑图"><a href="#网络拓扑图" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h1><p><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/network-topology.png" alt="网络拓扑图">    </p>
<h1 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h1><h2 id="下载ESXi"><a href="#下载ESXi" class="headerlink" title="下载ESXi"></a>下载ESXi</h2><p>到VMWare官方网站<a href="https://my.vmware.com/cn/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7" target="_blank" rel="noopener">下载ESXi 6.7版本</a>，下载的时候需要注册账号，然后申请试用，序列号请自行购买正版(或Google)。</p>
<h2 id="制作启动U盘"><a href="#制作启动U盘" class="headerlink" title="制作启动U盘"></a>制作启动U盘</h2><ul>
<li><p><strong>用老毛桃工具</strong><br>到老毛桃官网下载<a href="http://www.laomaotao.org/" target="_blank" rel="noopener">装机版老毛桃软件</a>:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao.png" alt="下载装机版老毛桃"><br>然后用老毛桃烧写U盘:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao1.png" alt="老毛桃烧写U盘"><br>在烧写好的U盘根目录中创建一个名字为<strong>MYEXT</strong>的文件夹，将下载的ESXi的ISO镜像放入该文件夹下:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao2.png" alt="创建MYEXT文件夹"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao3.png" alt="MYEXT文件夹放入镜像">    </p>
</li>
<li><p><strong>用软碟通UltraISO</strong><br>到软碟通官网下载UltraISO，然后启动并试用:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/UltraISO.png" alt="启动UltraISO"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/UltraISO1.png" alt="导入ISO镜像"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/UltraISO2.png" alt="写入U盘"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/UltraISO3.png" alt="启动烧写"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/UltraISO4.png" alt="烧写完成">     </p>
</li>
</ul>
<h2 id="软路由U盘启动安装ESXi"><a href="#软路由U盘启动安装ESXi" class="headerlink" title="软路由U盘启动安装ESXi"></a>软路由U盘启动安装ESXi</h2><ul>
<li><p><strong>UltraISO</strong>: U盘启动，按照提示安装即可。</p>
</li>
<li><p><strong>老毛桃</strong>: 用U盘启动软路由，进入PE，选在老毛桃PE中运行<strong>自定义镜像</strong>选项，选择刚刚放入MYEXT文件夹中的ESXi镜像，按照提示安装ESXi即可。<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao4.png" alt="老毛桃PE启界面"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao5.png" alt="运行自定义镜像"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/laomaotao6.png" alt="选择镜像">    </p>
</li>
</ul>
<p>进入安装界面:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-install1.png" alt="ESXi"><br>选择安装位置(我这里为了截图方便，我安装在VMWare虚拟机里)，多块硬盘已经要注意选择安装在哪块硬盘以及别安装在U盘上:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-install-Local.png" alt="选择安装ESXi的位置"><br>设置好密码(默认用户名为:root)，按照提示安装即可，注意安装结束的时候会提示<strong>先移除安装介质/U盘</strong>，然后按下回车重启:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-install2.png" alt="移除安装介质重启"><br>若启动前已经将网线插入则ESXi默认会根据网络动态获取IP，若启动前没有插网线则IP会为0.0.0.0:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-install-finished.png" alt="安装完成后重启界面">    </p>
<h2 id="设置ESXi"><a href="#设置ESXi" class="headerlink" title="设置ESXi"></a>设置ESXi</h2><p>安装完ESXi后重启，然后按<strong>F2</strong>进入ESXi设置界面:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting1.png" alt="进入设置界面"><br>选择<strong>Configure Management Network</strong>进入设置:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting2.png" alt="Configure Management Network"><br>选择<strong>IPv4 Configuration</strong>选项卡，然后回车:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting3.png" alt="IPv4 Configuration"><br>光标移动到<strong>Set Static IPv4 address and network configuration</strong>，然后用空格键选择，并设置：<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting4.png" alt="Set Static IPv4 address and network configuration">     </p>
<ul>
<li><strong>IPv4 Address</strong>: <strong>10.10.10.100</strong>    </li>
<li><strong>Subnet Mask</strong>: <strong>255.255.255.0</strong>    </li>
<li><strong>Default Gateway</strong>: <strong>10.10.10.10</strong>    </li>
<li>这里设置的默认网关<code>10.10.10.10</code>是给<code>iKuai</code>的后台地址</li>
</ul>
<p>按下回车键，然后按ESC键并输入Y保存设置:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting5.png" alt="保存设置"><br>设置生效后的界面如下，可以看出IP变为静态的了:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-setting6.png" alt="设置生效后的界面">    </p>
<h2 id="ESXi的web端设置"><a href="#ESXi的web端设置" class="headerlink" title="ESXi的web端设置"></a>ESXi的web端设置</h2><h3 id="设置笔记本网卡IP"><a href="#设置笔记本网卡IP" class="headerlink" title="设置笔记本网卡IP"></a>设置笔记本网卡IP</h3><p>将笔记本的网口用网线连接到软路由的<strong>LAN1</strong>口，并将笔记本有线网卡的IPv4设置为:    </p>
<ul>
<li><strong>IPv4</strong>: <strong>10.10.10.111</strong></li>
<li><strong>子网掩码</strong>: <strong>255.255.255.0</strong></li>
<li><strong>默认网关/路由器</strong>: <strong>10.10.10.10</strong><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-PC-IP.png" alt="笔记本IP设置">    </li>
</ul>
<p>浏览器打开<strong>10.10.10.100</strong>，然后输入设置的密码进入ESXi后台(用户名为root，密码为安装ESXi时候设置的密码):<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-web-login.png" alt="ESXI WEB login">    </p>
<h3 id="激活ESXi"><a href="#激活ESXi" class="headerlink" title="激活ESXi"></a>激活ESXi</h3><p>默认ESXi有试用期限制，解除限制需要用序列号激活ESXi:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-activate.png" alt="ESXi activate">    </p>
<h3 id="打开虚拟机交换机的混杂模式"><a href="#打开虚拟机交换机的混杂模式" class="headerlink" title="打开虚拟机交换机的混杂模式"></a>打开虚拟机交换机的混杂模式</h3><p>网络 -&gt; 虚拟交换机 -&gt; vSwitcho -&gt; 编辑设置 -&gt; 安全 -&gt; 混杂模式 -&gt; 接受<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-NetCard-Setting.png" alt="打开虚拟机的混杂模式">    </p>
<h3 id="网卡非直通情况"><a href="#网卡非直通情况" class="headerlink" title="网卡非直通情况"></a>网卡非直通情况</h3><ul>
<li>网络 -&gt; 虚拟交换机 -&gt; 添加交换机(多少个网口添加多少个) -&gt; 安全 -&gt; 全部接受</li>
<li>网络 -&gt; 端口组 -&gt; 添加端口组(多少个网口添加多少个) -&gt; 安全 -&gt; 全部接受</li>
</ul>
<h3 id="网卡直通情况"><a href="#网卡直通情况" class="headerlink" title="网卡直通情况"></a>网卡直通情况</h3><p>主机 -&gt; 硬件 -&gt; PCI设备 -&gt; 下拉选择<code>支持直通</code>来筛选网卡 -&gt; 选中后5个(共6个)端口。<br><strong>这里要注意不要将第一个(第一个好记)端口/LAN1设置为直通，否则导致进不去ESXi后台。</strong>    </p>
<p><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-networkcard.png" alt="网卡直通激活前"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/ESXi-networkcard1.png" alt="网卡直通激活后">     </p>
<p>设置好以后要单机<strong>重新引导主机</strong>，否则可能导致进不去ESXi的后台。    </p>
<h1 id="iKuai"><a href="#iKuai" class="headerlink" title="iKuai"></a>iKuai</h1><h2 id="安装iKuai"><a href="#安装iKuai" class="headerlink" title="安装iKuai"></a>安装iKuai</h2><p>下载iKuai的ISO文件，然后<strong>创建iKuai虚拟机的流程为</strong>:<br>存储-&gt;数据存储浏览器-&gt;创建文件夹-&gt;iKuai-&gt;将iKuai的ISO镜像上传到该文件夹下-&gt;虚拟机-&gt;新建虚拟机-&gt;客户机操作系统linux-&gt;客户机操作系统版本-&gt;其他64位-&gt;CD/DVD选择刚刚上传的iKuai的ISO文件-&gt;内存要勾选<strong>预留所有客户机内存(全部锁定)</strong><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install1.png" alt="安装iKuai step1"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install2.png" alt="安装iKuai step2"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install3.png" alt="安装iKuai step3"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install4.png" alt="安装iKuai step4"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install5.png" alt="安装iKuai step5"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install6.png" alt="安装iKuai step6"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install7.png" alt="安装iKuai step7">     </p>
<p><strong>这里要特别注意iKuai虚拟机的内存&gt;=4G</strong> ，否则会出现以下错误:    </p>
<p><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-install-error.png" alt="iKuai install error">    </p>
<h3 id="网卡非直通情况-1"><a href="#网卡非直通情况-1" class="headerlink" title="网卡非直通情况"></a>网卡非直通情况</h3><p>重新编辑iKuai虚拟机设 -&gt; 添加网络适配器并选择第6块虚拟网卡<strong>VM Network5</strong> ，配置好的界面如下:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-feizhitong.png" alt="网卡非直通">   </p>
<h3 id="网卡直通情况-1"><a href="#网卡直通情况-1" class="headerlink" title="网卡直通情况"></a>网卡直通情况</h3><p>重新编辑iKuai虚拟机设 -&gt; 添加PCI设备并选择对应的第6块网卡，配置好的界面如下:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-zhitong.png" alt="网卡直通">   </p>
<h2 id="设置iKuai"><a href="#设置iKuai" class="headerlink" title="设置iKuai"></a>设置iKuai</h2><p>启动iKuai虚拟机会自动安装iKuai，安装完以后按下回车键，显示:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-lan.png" alt="iKuai finished"><br>输入数字2，然后设置LAN1的IP地址:10.10.10.10:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-lan1.png" alt="iKuai finished"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-lan2.png" alt="iKuai finished"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-finished.png" alt="iKuai 设置IP">    </p>
<h2 id="iKuai的web端设置"><a href="#iKuai的web端设置" class="headerlink" title="iKuai的web端设置"></a>iKuai的web端设置</h2><p>电脑浏览器打开<strong>10.10.10.10</strong>，默认用户名<code>admin</code>，默认密码<code>admin</code>，进入iKuai的web客户端绑定WAN口:<br>网络设置 -&gt; 内外网设置 -&gt; 在接口状态会有一个空闲的wan1口 -&gt; 外网网口单击一下绑定上述空闲的wan1口即可:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-web1.png" alt="iKuai WEB1"><br>开启一条DHCP服务: 网络设置 -&gt; DHCP服务端 -&gt; 添加DCHP服务:   </p>
<ul>
<li>客户端地址: 10.10.10.101 - 10.10.10.254</li>
<li>子网掩码: 255.255.255.0</li>
<li>网关: 10.10.10.1   这里的网关是LEDE后台的地址</li>
<li>首选DNS: 114.114.114.114</li>
<li>备选DNS: 223.5.5.5<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/iKuai-web2.png" alt="iKuai DHCP">    </li>
</ul>
<p><strong>然后重启DHCP服务</strong>    </p>
<h1 id="LEDE"><a href="#LEDE" class="headerlink" title="LEDE"></a>LEDE</h1><h2 id="安装LEDE"><a href="#安装LEDE" class="headerlink" title="安装LEDE"></a>安装LEDE</h2><p>到KoolShare官网下载LEDE的固件，虚拟机转盘或PE下写盘专用-&gt;要选择combined格式，因为uefi格式下LEDE编辑的时候硬盘显示错误:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/lede1.png" alt="LEDE Download"><br>下载完成后解压到本地，然后用<strong>StarWind Converte</strong>将LEDE的.img格式转换为ESXi虚拟机文件。    </p>
<p><strong>创建LEDE虚拟机的流程为</strong>:<br>存储-&gt;数据存储浏览器-&gt;创建文件夹-&gt;LEDE-&gt;将上述转化后的两个文件上传到该目录下-&gt;虚拟机-&gt;新建虚拟机-&gt;客户机操作系统linux-&gt;客户机操作系统版本-&gt;其他64位-&gt;删除默认硬盘-&gt;添加现有硬盘-&gt;选择LEDE文件夹下上传的文件-&gt;内存要勾选<strong>预留所有客户机内存(全部锁定)</strong>:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install1.png" alt="LEDE step1"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install2.png" alt="LEDE step2"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install3.png" alt="LEDE step3"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install4.png" alt="LEDE step4"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install5.png" alt="LEDE step5">    </p>
<h3 id="网卡非直通情况-2"><a href="#网卡非直通情况-2" class="headerlink" title="网卡非直通情况"></a>网卡非直通情况</h3><p>重新编辑配置LEDE虚拟机-&gt;设置添加除了最后一块虚拟网卡外的其余虚拟网卡，配置好的界面如下:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-feizhitong.png" alt="网卡非直通">    </p>
<h3 id="网卡直通情况-2"><a href="#网卡直通情况-2" class="headerlink" title="网卡直通情况"></a>网卡直通情况</h3><p>重新编辑配置LEDE虚拟机-&gt;设置添加除了最后一块PCI设备以外的其余PCI设备，并对应其编号(最后一块给iKuai用了，假如错误的将所有PCI设备都加上了同时启动iKuai和LDDE的时候会提示设备错误)，配置好的界面如下:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-zhitong.png" alt="网卡直通">   </p>
<h2 id="设置LEDE"><a href="#设置LEDE" class="headerlink" title="设置LEDE"></a>设置LEDE</h2><p>启动iKuai虚拟机会自动安装iKuai，安装好以后按下回车:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install6.png" alt="LEDE step6"><br>设置IP地址为:<strong>10.10.10.1</strong> ，在虚拟机终端输入以下命令:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/config/network</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install7.png" alt="LEDE step7">    </p>
<p>然后将<strong>option ipaddr 192.168.1.1</strong>改为<strong>option ipaddr 10.10.10.1</strong> :<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-install8.png" alt="LEDE step8">    </p>
<p>然后重启LEDE虚拟机。    </p>
<h2 id="LEDE的web端设置"><a href="#LEDE的web端设置" class="headerlink" title="LEDE的web端设置"></a>LEDE的web端设置</h2><p>电脑浏览器打开<strong>10.10.10.10</strong>，默认密码<code>koolshare</code>，进入iKuai的web客户端:<br>网络 -&gt; 接口 -&gt; 关闭WAN -&gt; 关闭WAN6 -&gt; 编辑LAN:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-web1.png" alt="LEDE WEB1">    </p>
<p>LAN -&gt; 物理接口 -&gt; 接口 -&gt; <strong>选中</strong>:   </p>
<ul>
<li>bond0</li>
<li>erspan0</li>
<li>eth0 - echo4</li>
<li>ip_vti0</li>
<li>teql0</li>
</ul>
<p><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-web2.png" alt="LEDE WEB2">    </p>
<p>所要外接路由器作为AP，则需要将DHCP服务器-&gt;高级设置-&gt;强制勾选上。     </p>
<p><strong>LAN-&gt;基本设置-&gt;IPv4网关-&gt;10.10.10.10-&gt;使用自定义的DNS服务器-&gt;114.114.114.114</strong>:<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/LEDE-web3.png" alt="LEDE WEB3">    </p>
<h1 id="设置iKuai和LEDE开机自动启动"><a href="#设置iKuai和LEDE开机自动启动" class="headerlink" title="设置iKuai和LEDE开机自动启动"></a>设置iKuai和LEDE开机自动启动</h1><h2 id="iKuai和LEDE虚拟机里设置"><a href="#iKuai和LEDE虚拟机里设置" class="headerlink" title="iKuai和LEDE虚拟机里设置"></a>iKuai和LEDE虚拟机里设置</h2><p>在ESXi的WEB客户端-&gt;虚拟机-&gt;分别在iKuai和LEDE虚拟机上右键-&gt;自动启动 :<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/auto-start.png" alt="iKuai LEDE开启自动启动">     </p>
<h2 id="ESXi中设置自动启动"><a href="#ESXi中设置自动启动" class="headerlink" title="ESXi中设置自动启动"></a>ESXi中设置自动启动</h2><p>管理-&gt;系统-&gt;自动启动-&gt;编辑设置-&gt;是 :<br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/auto-start1.png" alt="ESXi 中设置自动启动"><br><img src="/2019/03/26/ESXi下安装iKuai和LEDE双软路由/auto-start2.png" alt="ESXi 中设置自动启动">    </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<ol>
<li><a href="https://www.vediotalk.com/" target="_blank" rel="noopener">vedio talk 官网</a>    </li>
<li><a href="https://www.youtube.com/channel/UCaMih5WXqoXq7Hg0S_XJdOg" target="_blank" rel="noopener">vedio talk YouTube频道</a>    </li>
<li><a href="https://space.bilibili.com/28459251" target="_blank" rel="noopener">vedio talk 哔哩哔哩频道</a>    </li>
<li><a href="https://www.youtube.com/channel/UCuhAUKCdKrjYoMiJQc74ZkQ" target="_blank" rel="noopener">tutu生活志 YouTube频道</a>    </li>
<li><a href="https://www.youtube.com/channel/UC6tPP3jOTKgjqfDgqMsaG4g" target="_blank" rel="noopener">JS神技能 YouTube频道</a>    </li>
<li><a href="https://www.youtube.com/channel/UCTVyuHy255movpxD44RuGqA" target="_blank" rel="noopener">七线图 YouTube频道</a>    </li>
<li><a href="https://www.youtube.com/channel/UCpPswAyGzdRwWmiW5oTNnvA" target="_blank" rel="noopener">BIGDONGDONG YouTube频道</a>    </li>
</ol>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://aimuch.com/2019/03/21/git教程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andy Liu">
      <meta itemprop="description" content="Engineer. Runner. Music">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风里刀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/21/git教程/" class="post-title-link" itemprop="url">git教程</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-21 17:31:27 / 修改时间：17:37:59" itemprop="dateCreated datePublished" datetime="2019-03-21T17:31:27+08:00">2019-03-21</time>
            </span>
          

          
            

            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config [--<span class="built_in">local</span> | --global | --system] user.name <span class="string">'Your name'</span></span><br><span class="line">git config [--<span class="built_in">local</span> | --global | --system] user.email <span class="string">'Your email'</span></span><br></pre></td></tr></table></figure>
<h1 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list [--<span class="built_in">local</span> | --global | --system]</span><br></pre></td></tr></table></figure>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span>：区域为本仓库</span><br><span class="line">global: 当前用户的所有仓库</span><br><span class="line">system: 本系统的所有用户</span><br></pre></td></tr></table></figure>
<h1 id="git-add-和-git-add-u区别"><a href="#git-add-和-git-add-u区别" class="headerlink" title="git add . 和 git add -u区别"></a><code>git add .</code> 和 <code>git add -u</code>区别</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git add . ：将工作空间新增和被修改的文件添加的暂存区</span><br><span class="line">git add -u :将工作空间被修改和被删除的文件添加到暂存区(不包含没有纳入Git管理的新增文件)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建仓库</span></span><br><span class="line">```bash</span><br><span class="line">git init [project folder name]  初始化 git 仓库</span><br><span class="line">git add [fileName]  把文件从工作目录添加到暂存区</span><br><span class="line">git commit -m<span class="string">'some information'</span>  用于提交暂存区的文件</span><br><span class="line">git commit -am<span class="string">'Some information'</span> 用于提交跟踪过的文件</span><br><span class="line">git <span class="built_in">log</span>  查看历史</span><br><span class="line">git status  查看状态</span><br></pre></td></tr></table></figure>
<p><strong>额外</strong><br>git add -u 可以添加所有已经被 git 控制的文件到暂存区<br>以前删除文件夹只会用 「-rf」，今天学到了 「-r」，并得知它们两个区别：「-r」 有时候会提示是否确认删除。    </p>
<h1 id="给文件重命名的简便方法"><a href="#给文件重命名的简便方法" class="headerlink" title="给文件重命名的简便方法"></a>给文件重命名的简便方法</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git  mv  [old file name]  [new file name]</span><br><span class="line">git commit -m <span class="string">'some information'</span></span><br></pre></td></tr></table></figure>
<h1 id="Tag标签"><a href="#Tag标签" class="headerlink" title="Tag标签"></a>Tag标签</h1><p><strong>显示已有标签</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></p>
<p><strong>新建标签</strong><br><em>创建一个含附注类型的标签非常简单，用 -a （译注：取 annotated 的首字母）指定标签名字即可</em><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a tag_name -m 'Some Messages'</span><br></pre></td></tr></table></figure></p>
<p><strong>删除标签</strong><br>删除本地标签:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d tag_name</span><br></pre></td></tr></table></figure></p>
<p>删除<code>remote</code>标签    :<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --delete origin tag_name</span><br></pre></td></tr></table></figure></p>
<p><strong>推送标签到github</strong><br>将本地<strong>所有</strong>标签推送到<code>remote</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure></p>
<h1 id="通过git-log查看版本演变历史"><a href="#通过git-log查看版本演变历史" class="headerlink" title="通过git log查看版本演变历史"></a>通过git log查看版本演变历史</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --all 查看所有分支的历史</span><br><span class="line">git <span class="built_in">log</span> --all --graph 查看图形化的 <span class="built_in">log</span> 地址</span><br><span class="line">git <span class="built_in">log</span> --oneline 查看单行的简洁历史。</span><br><span class="line">git <span class="built_in">log</span> --oneline -n4 查看最近的4条简洁历史。</span><br><span class="line">git <span class="built_in">log</span> --oneline --all -n4 --graph 查看所有分支最近4条单行的图形化历史。</span><br><span class="line">git <span class="built_in">help</span> --web <span class="built_in">log</span> 跳转到git <span class="built_in">log</span> 的帮助文档网页</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -v 查看本地有多少分支</span><br></pre></td></tr></table></figure>
<h1 id="通过图形界面工具来查看版本历史"><a href="#通过图形界面工具来查看版本历史" class="headerlink" title="通过图形界面工具来查看版本历史"></a>通过图形界面工具来查看版本历史</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitk</span><br></pre></td></tr></table></figure>
<h1 id="探密-git目录"><a href="#探密-git目录" class="headerlink" title="探密.git目录"></a>探密<code>.git</code>目录</h1><p>查看<code>.git</code>文件夹下的内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls .git/ -al</span><br></pre></td></tr></table></figure></p>
<p>如下:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 17 22:38 ./</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 17 21:50 ../</span><br><span class="line">-rw-r--r-- 1 Andy 197609   7 12月 17 22:38 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r-- 1 Andy 197609 301 12月 12 22:55 config</span><br><span class="line">-rw-r--r-- 1 Andy 197609  73 12月 12 22:55 description</span><br><span class="line">-rw-r--r-- 1 Andy 197609  96 12月 19 00:00 FETCH_HEAD</span><br><span class="line">-rw-r--r-- 1 Andy 197609  23 12月 12 22:55 HEAD</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 12 22:55 hooks/</span><br><span class="line">-rw-r--r-- 1 Andy 197609 249 12月 17 22:38 index</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 12 22:55 info/</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 12 22:55 logs/</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 17 22:38 objects/</span><br><span class="line">-rw-r--r-- 1 Andy 197609 114 12月 12 22:55 packed-refs</span><br><span class="line">drwxr-xr-x 1 Andy 197609   0 12月 12 22:55 refs/</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat命令主要用来查看文件内容，创建文件，文件合并，追加文件内容等功能。</span><br><span class="line">cat HEAD 查看HEAD文件的内容</span><br><span class="line">git cat-file 命令 显示版本库对象的内容、类型及大小信息。</span><br><span class="line">git cat-file -t b44dd71d62a5a8ed3 显示版本库对象的类型</span><br><span class="line">git cat-file -s b44dd71d62a5a8ed3 显示版本库对象的大小</span><br><span class="line">git cat-file -p b44dd71d62a5a8ed3 显示版本库对象的内容</span><br></pre></td></tr></table></figure>
<p><code>.git</code>里几个常用的如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HEAD：指向当前的工作路径</span><br><span class="line">config：存放本地仓库（<span class="built_in">local</span>）相关的配置信息。</span><br><span class="line">refs/heads: 存放分支</span><br><span class="line">refs/heads/master/: 指向master分支最后一次commit</span><br><span class="line">refs/tags: 存放tag，又叫里程牌 （当这次commit是具有里程碑意义的 比如项目1.0的时候 就可以打tag）</span><br><span class="line">objects：核心文件，存储文件</span><br></pre></td></tr></table></figure></p>
<p>.git/objects/ 存放所有的 git 对象，对象哈希值前 2 位作为文件夹名称，后 38 位作为对象文件名, 可通过 git cat-file -p 命令，拼接文件夹名称+文件名查看。    </p>
<h1 id="commit、tree和blob三个对象之间的关系"><a href="#commit、tree和blob三个对象之间的关系" class="headerlink" title="commit、tree和blob三个对象之间的关系"></a><code>commit</code>、<code>tree</code>和<code>blob</code>三个对象之间的关系</h1><p><img src="/2019/03/21/git教程/img1.jpg" alt="tree">     </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit: 提交时的镜像</span><br><span class="line">tree: 文件夹</span><br><span class="line">blob: 文件</span><br></pre></td></tr></table></figure>
<p><strong>【同学问题】</strong> 每次commit，git 都会将当前项目的所有文件夹及文件快照保存到objects目录，如果项目文件比较大，不断迭代，commit无数次后，objects目录中文件大小是不是会变得无限大？<br><strong>【老师解答】</strong> Git对于内容相同的文件只会存一个blob，不同的commit的区别是commit、tree和有差异的blob，多数未变更的文件对应的blob都是相同的，这么设计对于版本管理系统来说可以省很多存储空间。其次，Git还有增量存储的机制，我估计是对于差异很小的blob设计的吧。    </p>
<h1 id="分离头指针情况下的注意事项"><a href="#分离头指针情况下的注意事项" class="headerlink" title="分离头指针情况下的注意事项"></a>分离头指针情况下的注意事项</h1><p>detached HEAD   </p>
<h1 id="进一步理解HEAD和branch"><a href="#进一步理解HEAD和branch" class="headerlink" title="进一步理解HEAD和branch"></a>进一步理解<code>HEAD</code>和<code>branch</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b new_branch [具体分支 或 commit] 创建新分支并切换到新分支</span><br><span class="line">git diff HEAD HEAD~1 比较最近两次提交</span><br><span class="line">git diff HEAD HEAD~2 比较最近和倒数第三次提交</span><br><span class="line">git diff HEAD HEAD^  比较最近两次提交</span><br><span class="line">git diff HEAD HEAD^^ 比较最近和倒数第三次提交</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 怎么删除不需要的分支？</span></span><br><span class="line">查看分支：   </span><br><span class="line">```bash</span><br><span class="line">git branch -av</span><br></pre></td></tr></table></figure>
<p>删除分支命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d [branch name]  <span class="comment">#删除</span></span><br><span class="line">git branch -D [branch name]  <span class="comment">#强制删除</span></span><br></pre></td></tr></table></figure></p>
<h1 id="怎么修改最新commit的message"><a href="#怎么修改最新commit的message" class="headerlink" title="怎么修改最新commit的message"></a>怎么修改最新commit的message</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend  对最近一次的commit信息进行修改</span><br></pre></td></tr></table></figure>
<h1 id="怎么修改老旧commit的message"><a href="#怎么修改老旧commit的message" class="headerlink" title="怎么修改老旧commit的message"></a>怎么修改老旧commit的message</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i [要更改的commit的上一级commit]</span><br></pre></td></tr></table></figure>
<p>接下来就是一个交互过程…<br>这期间会产生一个detached HEAD，然后将改好的commit指向该detached HEAD，如下图所示：<br><img src="/2019/03/21/git教程/img2.jpg" alt="rebase">    </p>
<p><strong>git rebase工作的过程中，就是用了分离头指针。rebase意味着基于新base的commit来变更部分commits。它处理的时候，把HEAD指向base的commit，此时如果该commit没有对应branch，就处于分离头指针的状态，然后重新一个一个生成新的commit，当rebase创建完最后一个commit后，结束分离头状态，Git让变完基的分支名指向HEAD。</strong>    </p>
<h1 id="怎样把连续的多个commit整理成1个"><a href="#怎样把连续的多个commit整理成1个" class="headerlink" title="怎样把连续的多个commit整理成1个"></a>怎样把连续的多个commit整理成1个</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i [要更改的commit的上一级commit]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph</span><br><span class="line">* commit 7d3386842a2168ae630b65f687364243139c893c (HEAD -&gt; master, origin/master, origin/HEAD)</span><br><span class="line">| Author: aimuch &lt;liuvay@gmail.com&gt;</span><br><span class="line">| Date:   Thu Dec 20 23:34:18 2018 +0800</span><br><span class="line">|</span><br><span class="line">|     update</span><br><span class="line">|</span><br><span class="line">* commit 9eb3188bbc63cae1bfed5f9dfc1593019e360a6a</span><br><span class="line">| Author: aimuch &lt;liuvay@gmail.com&gt;</span><br><span class="line">| Date:   Wed Dec 19 20:30:14 2018 +0800</span><br><span class="line">|</span><br><span class="line">|     update</span><br><span class="line">|</span><br><span class="line">* commit bbe6d53e2b477f2d2aa402af7f315ecdfc63459e</span><br><span class="line">| Author: aimuch &lt;liuvay@gmail.com&gt;</span><br><span class="line">| Date:   Wed Dec 19 20:12:29 2018 +0800</span><br><span class="line">|</span><br><span class="line">|     update</span><br><span class="line">|</span><br><span class="line">* commit 7735d66ded7f98adeca93d96fb7be12ffb67c76a</span><br><span class="line">| Author: aimuch &lt;liuvay@gmail.com&gt;</span><br><span class="line">| Date:   Wed Dec 19 00:27:00 2018 +0800</span><br><span class="line">|</span><br><span class="line">|     update</span><br><span class="line">|</span><br><span class="line">* commit d9f9d115fab425b5654f8ccfec6a996aef35b76b</span><br><span class="line">| Author: aimuch &lt;liuvay@gmail.com&gt;</span><br><span class="line">| Date:   Wed Dec 19 00:23:36 2018 +0800</span><br><span class="line">|</span><br><span class="line">|     update</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pick   7735d66 update <span class="comment">#合并到该commit上</span></span><br><span class="line">squash bbe6d53 update</span><br><span class="line">squash 9eb3188 update</span><br><span class="line">squash 7d33868 update</span><br><span class="line"><span class="comment"># Rebase d9f9d11..7d33868 onto d9f9d11 (4 commands)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment"># p, pick &lt;commit&gt; = use commit</span></span><br><span class="line"><span class="comment"># r, reword &lt;commit&gt; = use commit, but edit the commit message</span></span><br><span class="line"><span class="comment"># e, edit &lt;commit&gt; = use commit, but stop for amending</span></span><br><span class="line"><span class="comment"># s, squash &lt;commit&gt; = use commit, but meld into previous commit</span></span><br><span class="line"><span class="comment"># f, fixup &lt;commit&gt; = like "squash", but discard this commit's log message</span></span><br><span class="line"><span class="comment"># x, exec &lt;command&gt; = run command (the rest of the line) using shell</span></span><br><span class="line"><span class="comment"># b, break = stop here (continue rebase later with 'git rebase --continue')</span></span><br><span class="line"><span class="comment"># d, drop &lt;commit&gt; = remove commit</span></span><br><span class="line"><span class="comment"># l, label &lt;label&gt; = label current HEAD with a name</span></span><br><span class="line"><span class="comment"># t, reset &lt;label&gt; = reset HEAD to a label</span></span><br><span class="line"><span class="comment"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span></span><br><span class="line"><span class="comment"># .       create a merge commit using the original merge commit's</span></span><br><span class="line"><span class="comment"># .       message (or the oneline, if no original merge commit was</span></span><br><span class="line"><span class="comment"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a combination of 4 commits.</span></span><br><span class="line"><span class="comment"># This is the 1st commit message:</span></span><br><span class="line"></span><br><span class="line">update</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the commit message #2:</span></span><br><span class="line"></span><br><span class="line">update</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the commit message #3:</span></span><br><span class="line"></span><br><span class="line">update</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the commit message #4:</span></span><br><span class="line"></span><br><span class="line">update</span><br></pre></td></tr></table></figure>
<h1 id="git修改gitignore后生效"><a href="#git修改gitignore后生效" class="headerlink" title="git修改gitignore后生效"></a>git修改gitignore后生效</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .    <span class="comment">#清除缓存</span></span><br><span class="line">git add .               <span class="comment">#重新trace file</span></span><br><span class="line">git commit -m <span class="string">"update .gitignore"</span> <span class="comment">#提交和注释</span></span><br><span class="line">git push origin master  <span class="comment">#可选，如果需要同步到remote上的话</span></span><br></pre></td></tr></table></figure>
<h1 id="怎么比较暂存区和HEAD所含文件的差异？"><a href="#怎么比较暂存区和HEAD所含文件的差异？" class="headerlink" title="怎么比较暂存区和HEAD所含文件的差异？"></a>怎么比较暂存区和HEAD所含文件的差异？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --staged</span><br></pre></td></tr></table></figure></p>
<h1 id="怎么比较工作区和暂存区所含文件的差异？"><a href="#怎么比较工作区和暂存区所含文件的差异？" class="headerlink" title="怎么比较工作区和暂存区所含文件的差异？"></a>怎么比较工作区和暂存区所含文件的差异？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff -- [filename/pathname] <span class="comment">#比较具体的文件或者路径</span></span><br></pre></td></tr></table></figure>
<h1 id="如何让暂存区恢复成和HEAD的一样？"><a href="#如何让暂存区恢复成和HEAD的一样？" class="headerlink" title="如何让暂存区恢复成和HEAD的一样？"></a>如何让暂存区恢复成和HEAD的一样？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git reset 有三个参数</span><br><span class="line">--soft 这个只是把 HEAD 指向的 commit 恢复到你指定的 commit，暂存区 工作区不变</span><br><span class="line">--hard 这个是 把 HEAD， 暂存区， 工作区 都修改为 你指定的 commit 的时候的文件状态</span><br><span class="line">--mixed 这个是不加时候的默认参数，把 HEAD，暂存区 修改为 你指定的 commit 的时候的文件状态，工作区保持不变</span><br></pre></td></tr></table></figure>
<h1 id="如何让工作区的文件恢复为和暂存区一样？"><a href="#如何让工作区的文件恢复为和暂存区一样？" class="headerlink" title="如何让工作区的文件恢复为和暂存区一样？"></a>如何让工作区的文件恢复为和暂存区一样？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- &lt;file&gt;...</span><br></pre></td></tr></table></figure>
<p><strong>恢复工作区用checkout，恢复暂存区用reset。</strong>   </p>
<h1 id="怎样取消暂存区部分文件的更改？"><a href="#怎样取消暂存区部分文件的更改？" class="headerlink" title="怎样取消暂存区部分文件的更改？"></a>怎样取消暂存区部分文件的更改？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD -- &lt;file&gt;...</span><br></pre></td></tr></table></figure>
<h1 id="看看不同提交的指定文件的差异"><a href="#看看不同提交的指定文件的差异" class="headerlink" title="看看不同提交的指定文件的差异"></a>看看不同提交的指定文件的差异</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff commit-id1 commit-id2 -- &lt;file&gt;...</span><br></pre></td></tr></table></figure>
<h1 id="正确删除文件的方法"><a href="#正确删除文件的方法" class="headerlink" title="正确删除文件的方法"></a>正确删除文件的方法</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm &lt;file&gt;</span><br></pre></td></tr></table></figure>
<h1 id="开发中临时加塞了紧急任务怎么处理？"><a href="#开发中临时加塞了紧急任务怎么处理？" class="headerlink" title="开发中临时加塞了紧急任务怎么处理？"></a>开发中临时加塞了紧急任务怎么处理？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stash list <span class="comment">#查看stash中存放的信息</span></span><br><span class="line">git stash <span class="comment">#将当前工作区内容存放到"堆栈"中</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply <span class="comment">#把"堆栈"里面的内容弹出到工作区中，同时"堆栈"中信息还在</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop <span class="comment">#把"堆栈"里面的内容弹出到工作区中，同时丢弃"堆栈"中最新的信息</span></span><br></pre></td></tr></table></figure>
<h1 id="如何指定不需要Git管理的文件？"><a href="#如何指定不需要Git管理的文件？" class="headerlink" title="如何指定不需要Git管理的文件？"></a>如何指定不需要Git管理的文件？</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.gitignore</span><br></pre></td></tr></table></figure>
<p><strong>【同学提问】</strong> 如果提交commit后，想再忽略一些已经提交的文件，怎么处理。<br><strong>【老师回答】</strong> The problem is that .gitignore ignores just files that weren’t tracked before (by git add). Run git reset name_of_file to unstage the file and keep it. In case you want to also remove given file from the repository (after pushing), use git rm –cached name_of_file.<br>把想忽略的文件添加到 .gitignore ；然后通过 git rm – cached name_of_file 的方式删除掉git仓库里面无需跟踪的文件。    </p>
<h1 id="添加远程仓库"><a href="#添加远程仓库" class="headerlink" title="添加远程仓库"></a>添加远程仓库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add [shortname] [url]</span><br></pre></td></tr></table></figure>
<h1 id="配置公私钥"><a href="#配置公私钥" class="headerlink" title="配置公私钥"></a>配置公私钥</h1><h2 id="检查是否已存在相应的ssh-key"><a href="#检查是否已存在相应的ssh-key" class="headerlink" title="检查是否已存在相应的ssh key:"></a>检查是否已存在相应的<code>ssh key</code>:</h2><p>打开终端, 输入:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al ~/.ssh</span><br></pre></td></tr></table></figure></p>
<p>核对列出来的ssh key是否有已存在的，假如你没有看到列出的公私钥对，或是不想再用之前的公私钥对，你可以选择下面的步骤生成新的公私钥对.    </p>
<h2 id="生成新的ssh-key-并添加至ssh-agent"><a href="#生成新的ssh-key-并添加至ssh-agent" class="headerlink" title="生成新的ssh key,并添加至ssh-agent:"></a>生成新的<code>ssh key</code>,并添加至<code>ssh-agent</code>:</h2><h3 id="2-1-打开终端-使用ssh-key生成命令："><a href="#2-1-打开终端-使用ssh-key生成命令：" class="headerlink" title="2.1 打开终端, 使用ssh key生成命令："></a>2.1 打开终端, 使用<code>ssh key</code>生成命令：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C "your_email@example.com"</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong> ：后面的邮箱对应相应账号的邮箱，假如是github的账号，且注册账号的邮箱为<a href="mailto:`xxx@gmail.com" target="_blank" rel="noopener">`xxx@gmail.com</a>`，则命令行为：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C "xxx@gmail.com"`。    </span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 接下来会提示你保存的`ssh key`的名称以及路径。    </span></span></span><br><span class="line">默认路径是`/home/you/.ssh/id_rsa`(`you`为用户个人目录)即`~/.ssh/id_rsa`。这一步很重要，如果你使用默认的，且下一个账号也是使用默认的路径和文件名，那么之前的`ssh key`就会被后来生成的`ssh key`重写，从而导致之前的账号不可用。因此，正确的做法是给它命名，最后以应用名进行命名，因为更容易区分。以下是我个人配的：    </span><br><span class="line">```shell</span><br><span class="line">/home/andy/.ssh/github_rsa</span><br></pre></td></tr></table></figure></p>
<h3 id="接下来会提示设置ssh安全密码。"><a href="#接下来会提示设置ssh安全密码。" class="headerlink" title="接下来会提示设置ssh安全密码。"></a>接下来会提示设置ssh安全密码。</h3><p>这一步可以使用默认的（即不设置密码），直接按回车即可。<br>这里会生成<code>xxx_rsa</code>和<code>xxx_rsa.pub</code>两个文件,<code>xxx_rsa</code>是生成的<code>ssh key</code>的私钥名，<code>xxx_rsa.pub</code>是生成的<code>ssh key</code>的公钥名，私钥要放在本地，公钥要放在服务器或github的Settings-&gt;SSHand GPG keys-&gt;New SSH key上。<br><img src="/2019/03/21/git教程/git-key.png" alt="git key">     </p>
<h3 id="ssh-key生成后，接下来需要为ssh-key添加代理。"><a href="#ssh-key生成后，接下来需要为ssh-key添加代理。" class="headerlink" title="ssh key生成后，接下来需要为ssh key添加代理。"></a><code>ssh key</code>生成后，接下来需要为<code>ssh key</code>添加代理。</h3><p>这是为了让请求自动对应相应的账号。网上很多文章写到需要另外配置<code>config</code>文件，经本人亲测，其实是不需要的，在生成了<code>ssh key</code>后，通过为生成的<code>ssh key</code>添加代理即可，为<code>ssh key</code>添加代理命令:<strong><code>ssh-add ~/.ssh/xxx_rsa</code></strong>， <code>xxx_rsa</code>是你生成的<code>ssh key</code>的私钥名，我的设置为:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~/.ssh/github_rsa</span><br></pre></td></tr></table></figure></p>
<h2 id="将生成的xxx-rsa-pub公钥内容添加到GitHub的SSH-keys页面上。"><a href="#将生成的xxx-rsa-pub公钥内容添加到GitHub的SSH-keys页面上。" class="headerlink" title="将生成的xxx_rsa.pub公钥内容添加到GitHub的SSH keys页面上。"></a>将生成的<code>xxx_rsa.pub</code>公钥内容添加到GitHub的SSH keys页面上。</h2><p><img src="/2019/03/21/git教程/github-ssh.png" alt="github ssh">    </p>
<h2 id="连接测试"><a href="#连接测试" class="headerlink" title="连接测试"></a>连接测试</h2><p>接下来我们测试是否配置成功，打开终端，输入:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/21/git教程/git-test.png" alt="git test">    </p>
<h1 id="怎么快速淘到感兴趣的开源项目"><a href="#怎么快速淘到感兴趣的开源项目" class="headerlink" title="怎么快速淘到感兴趣的开源项目"></a>怎么快速淘到感兴趣的开源项目</h1><p><strong>UI界面高级搜索</strong>： <a href="https://github.com/search/advanced" target="_blank" rel="noopener">https://github.com/search/advanced</a>     </p>
<p><strong>命令高级搜索</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git 最好 学习 资料 <span class="keyword">in</span>:readme stars:&gt;1000 language:c</span><br></pre></td></tr></table></figure></p>
<p>上述命令的意思是搜索reademe中包含<code>git、最好、学习、资料</code>”且<code>star大于1000</code>的，用<code>C语言编写</code>的仓库。    </p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://aimuch.com/2019/03/21/caffe数据格式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andy Liu">
      <meta itemprop="description" content="Engineer. Runner. Music">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风里刀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/21/caffe数据格式/" class="post-title-link" itemprop="url">caffe数据格式</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-21 11:20:09" itemprop="dateCreated datePublished" datetime="2019-03-21T11:20:09+08:00">2019-03-21</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-03-22 14:20:21" itemprop="dateModified" datetime="2019-03-22T14:20:21+08:00">2019-03-22</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Caffe/" itemprop="url" rel="index"><span itemprop="name">Caffe</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Google-Protocol-Buffers-概述"><a href="#Google-Protocol-Buffers-概述" class="headerlink" title="Google Protocol Buffers 概述"></a>Google Protocol Buffers 概述</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>Protocol Buffers</strong> 是一种轻便高效的结构化数据存储格式，可以用于结构化数据串行化，或者说序列化。它很适合做<strong>数据存储</strong>或 <strong>RPC(Remote Procedure Call)</strong> 数据交换格式。可用于通讯协议、数据存储等领域的语言无关、平台无关、可扩展的序列化结构数据格式。目前提供了 <code>C++</code>、<code>Java</code>、<code>Python</code> 三种语言的 API。</p>
<p>本文概述介绍<strong>Protocol Buffers</strong>，以及开始如何开始<strong>Protocol Buffers</strong>之旅，本系列主要以Java为主。</p>
<p>以下<strong>Protocol Buffers</strong>简称PB。</p>
<h2 id="Protocol-Buffers是什么"><a href="#Protocol-Buffers是什么" class="headerlink" title="Protocol Buffers是什么"></a>Protocol Buffers是什么</h2><p>Protocol Buffers提供了一种灵活，高效，自动序列化结构数据的机制，可以联想XML，但是比XML更小，更快，更简单。仅需要自定义一次你所需的数据格式， 然后用户就可以使用Protocol Buffers自动生成的特定的源码，方便的读写用户自定义的格式化的数据。不限语言，不限平台。还可以在不破坏原数据格式的基础上，依据老的数据格式， 更新现有的数据格式。</p>
<h2 id="Protocol-Buffers如何工作的"><a href="#Protocol-Buffers如何工作的" class="headerlink" title="Protocol Buffers如何工作的"></a>Protocol Buffers如何工作的</h2><p>在PB中，有一种.proto类型的文件，用户 在.proto文件中定义PB “Message”来指定所需要序列化的数据的格式。每一个PB Message都是一个小的信息逻辑单元，包含了一些列的name-value对。下面举例说明一个简单地.proto文件，他定义了一条包含一个 Person信息的Message：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">message Person &#123;</span><br><span class="line">  required <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">  required int32 id = <span class="number">2</span>;</span><br><span class="line">  optional <span class="built_in">string</span> email = <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">enum</span> PhoneType &#123;</span><br><span class="line">    MOBILE = <span class="number">0</span>;</span><br><span class="line">    HOME = <span class="number">1</span>;</span><br><span class="line">    WORK = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  message PhoneNumber &#123;</span><br><span class="line">    required <span class="built_in">string</span> number = <span class="number">1</span>;</span><br><span class="line">    optional PhoneType type = <span class="number">2</span> [<span class="keyword">default</span> = HOME];</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  repeated PhoneNumber phone = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上代码所示，PB message 格式非常简单。每种类型的message包含一个或者多个唯一编码字段，每个字段由名称和值类型组成，值类型可以使数字(整形或者浮点型)，布尔值，字符 串，原始字节，甚至是其他的PB message。PB允许message中包含message，已达到分层嵌套。可以定义可选字段，必填字段以及重复字段。想要了解更多如何 写.proto 文件，可以访问：Protocol Buffer Language Guide</p>
<p>定 义好PB message后，选择合适语言的PB编译器，编译.proto文件，就可以生成存取数据的相关类。这些类包括简单的设置及读取字段的方法，也包括对整个 数据结构的message与二进制之间的转换。举个例子，如果你使用的语言是java，运行编译器编译上例.proto文件后，生成的类中包含一个 Person类。使用该类，就可以计算，序列化以及检索PB message。如下代码:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> throws IOException </span>&#123;</span><br><span class="line">    Person john = Person</span><br><span class="line">            .newBuilder()</span><br><span class="line">            .setId(<span class="number">1</span>)</span><br><span class="line">            .setName(<span class="string">"john"</span>)</span><br><span class="line">            .setEmail(<span class="string">"john@youku.com"</span>)</span><br><span class="line">            .addPhone(</span><br><span class="line">                PhoneNumber</span><br><span class="line">                    .newBuilder()</span><br><span class="line">                    .setNumber(<span class="string">"1861xxxxxxx"</span>)</span><br><span class="line">                    .setType(PhoneType.WORK)</span><br><span class="line">                    .build())</span><br><span class="line">            .build();</span><br><span class="line">    FileOutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">"abc.txt"</span>);</span><br><span class="line">    john.writeTo(output);</span><br><span class="line">    output.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来，你可以用如下代码读取：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> throws IOException </span>&#123;</span><br><span class="line">    FileInputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">"abc.txt"</span>);</span><br><span class="line">    Person person = Person.parseFrom(input);</span><br><span class="line">    System.out.println(person.getId());</span><br><span class="line">    System.out.println(person.getName());</span><br><span class="line">    System.out.println(person.getEmail());</span><br><span class="line">    System.out.println(person.getPhoneCount());</span><br><span class="line">    System.out.println(person.getPhone(<span class="number">0</span>).getNumber());</span><br><span class="line">    System.out.println(person.getPhone(<span class="number">0</span>).getType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>PB是易于扩展的，可以向后兼容的，我们可以在PB message中添加新的字段，这样，在parse的时候，老版本的数据就会简单的忽略新增加的字段。因此，如果现有通信协议使用了PB作为其数据格式，我们可以直接扩展该通信协议，而不必担心这将会破坏现有的代码。</p>
<p>对于使用.proto文件生成PB 客户端代码，可以参看这方面的完整教程：API Reference section。想要学习了解PB message是如何编码的，可以参见：Protocol Buffer Encoding。</p>
<h2 id="为什么不直接使用XML呢？"><a href="#为什么不直接使用XML呢？" class="headerlink" title="为什么不直接使用XML呢？"></a>为什么不直接使用XML呢？</h2><p>如果要序列化结构化数据，比起XML，PB实在是有许多的优点可以道道~</p>
<p>更简单<br>比XML小3~10倍<br>比XML快20~100倍<br>语义定义明确<br>自动生成数据存取类，更容易使用<br>假如我们要模拟一个Person，该对象包含name和email属性，如果用XML，我们定义如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>John Doe<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">email</span>&gt;</span>jdoe@example.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>对应的，PB如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person &#123;</span><br><span class="line">  name: "John Doe"</span><br><span class="line">  email: "jdoe@example.com"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>请注意：这里仅是PB格式的一种直观表示，真实的PB并非这样存储，实际上，在链路中，PB数据时二进制格式的。</p>
<p>当这段数据编码为PB二进制格式时，其实际大小大概是28bytes，编码时间为100~200纳秒。如果用XML的话，即使去除空格，大小也至少为69bytes，编码时间大概需要5000~10,000纳秒。</p>
<p>同样，解析这段代码，PB比XML要方便许多。用PB的话：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person.getName();</span><br><span class="line">person.getEmail();</span><br></pre></td></tr></table></figure></p>
<p>而用XML的话：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">personNode.getElementsByTagName("name")</span><br><span class="line">personNode.getElementsByTagName("email")</span><br></pre></td></tr></table></figure></p>
<p>相比起来，PB更直接，而且不需要遍历节点等XML操作。</p>
<p>但是，金无足赤，人无完人，PB也一样。对于有很多标签的，基于文本的数据(例如HTML)，XML就完胜PB。XML是子描述的，可以随机且交错读取读取文本节点。XML是自描述的，而PB不是，PB必须要有格式定义文件(.proto 文件)</p>
<h2 id="一点历史"><a href="#一点历史" class="headerlink" title="一点历史"></a>一点历史</h2><p>PB由Google开发，最初是用于处理索引服务器的请求/响应协议。在有PB之前，Google使用手动编组和解组的方式来处理请求/相应协议。这种方式需要支持许多版本的协议，这就导致一些代码非常的丑陋，例如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (version == <span class="number">3</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (version &gt; <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (version == <span class="number">5</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>另外，这种显示格式的协议同样将新发布的协议版本也搞得非常复杂，因为开发者必须在启用新的协议之前，确认所有的服务器，包括请求的发起者以及实际处理请求者，他们都能够理解新的协议。</p>
<p>PB即被设计来解决这些问题：</p>
<p>要可以非常容易的引入新字段，不需要检查数据的中间服务器 能够简单地解析数据，并且无须知道数据所有的字段就可以传输数据。<br>格式能够更加的自描述一些，并且可以被多用语言处理(C ++， Java，Python等)<br>至此，虽然解决了诸多问题，但用户依然需要手写他们的解析及编码代码。</p>
<p>随着系统的发展，PB逐渐形成了许多新的特性及用法：</p>
<p> 自动生成序列化及反序列化代码，避免手动解析<br>除了被用在短生命周期的RPC请求，也开始将PB作为一种方便的自描述格式去存储持久化数据。<br>Server RPC interfaces 开始被声明为协议文件的一部分，使用PB compiler 生成stub类，用户可以使用自己实现的服务器接口来覆盖他们。<br>Google Protocol Buffer( 简称 Protobuf) 是 Google 公司内部的混合语言数据标准，目前已经正在使用的有超过 48,162 种报文格式定义和超过 12,183 个 .proto 文件。他们用于 RPC 系统和持续数据存储系统。</p>
<p>译自：<a href="https://developers.google.com/protocol-buffers/docs/overview" target="_blank" rel="noopener">https://developers.google.com/protocol-buffers/docs/overview</a></p>
<hr>
<h1 id="Google-Protocol-Buffers-入门"><a href="#Google-Protocol-Buffers-入门" class="headerlink" title="Google Protocol Buffers 入门"></a>Google Protocol Buffers 入门</h1><hr>
<h1 id="Protocol-Buffers-语法指南"><a href="#Protocol-Buffers-语法指南" class="headerlink" title="Protocol Buffers 语法指南"></a>Protocol Buffers 语法指南</h1><hr>
<h1 id="Google-Protocol-Buffers-编码-Encoding"><a href="#Google-Protocol-Buffers-编码-Encoding" class="headerlink" title="Google Protocol Buffers 编码(Encoding)"></a>Google Protocol Buffers 编码(Encoding)</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="http://www.cnblogs.com/shitouer/archive/2013/04/08/google-protocol-buffers-overview.html" target="_blank" rel="noopener">Google Protocol Buffers 概述</a></p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://aimuch.com/2019/03/17/搭建深度学习服务器环境/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andy Liu">
      <meta itemprop="description" content="Engineer. Runner. Music">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风里刀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/17/搭建深度学习服务器环境/" class="post-title-link" itemprop="url">搭建深度学习服务器环境</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-17 22:27:33" itemprop="dateCreated datePublished" datetime="2019-03-17T22:27:33+08:00">2019-03-17</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-03-26 15:10:31" itemprop="dateModified" datetime="2019-03-26T15:10:31+08:00">2019-03-26</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装Ubuntu和Windows双系统"><a href="#安装Ubuntu和Windows双系统" class="headerlink" title="安装Ubuntu和Windows双系统"></a>安装Ubuntu和Windows双系统</h1><p>详细的安装双系统就不过多介绍了，可以参考<a href="https://blog.csdn.net/s717597589/article/details/79117112/" target="_blank" rel="noopener">这篇文章</a>，但是在安装过程中有几个问题需要说明：      </p>
<ul>
<li><p>安装Ubuntu之前首先要把BIOS的<code>security boot</code>关闭，否则会出现NVIDIA驱动安装完以后重启电脑会反复进入登录界面。</p>
</li>
<li><p>硬盘分区的时候可以只分为<code>swap</code>、<code>UEFI</code>、<code>\</code>和<code>\home</code>四个分区，不分<code>\home</code>也可以，在挂在<code>\</code>分区的时候会自动生成<code>\home</code>和其他分区，但是在重装系统的时候<code>\home</code>无法重新挂在之前的<code>\home</code>分区导致数据丢失（类似于Windows的非系统盘）。</p>
</li>
<li><p>重装Ubuntu系统时请早Windows下用EasyUEFI软件将Ubuntu的引导项删除。</p>
</li>
</ul>
<hr>
<h1 id="安装NVIDIA驱动"><a href="#安装NVIDIA驱动" class="headerlink" title="安装NVIDIA驱动"></a>安装NVIDIA驱动</h1><h2 id="安装驱动NVIDIA所需的依赖包"><a href="#安装驱动NVIDIA所需的依赖包" class="headerlink" title="安装驱动NVIDIA所需的依赖包"></a>安装驱动NVIDIA所需的依赖包</h2><p><em>在终端里依次输入以下命令安装驱动所需的依赖包</em><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libhdf5-serial-dev protobuf-compiler</span><br><span class="line">sudo apt-get install --no-install-recommends libboost-all-dev</span><br><span class="line">sudo apt-get install libopenblas-dev liblapack-dev libatlas-base-dev</span><br><span class="line">sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev</span><br><span class="line">sudo apt-get install git cmake build-essential</span><br></pre></td></tr></table></figure></p>
<p>假如有安装包一直下载失败，可以使用：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<h2 id="禁用Ubuntu自带的显卡驱动"><a href="#禁用Ubuntu自带的显卡驱动" class="headerlink" title="禁用Ubuntu自带的显卡驱动"></a>禁用Ubuntu自带的显卡驱动</h2><p>Ubuntu 16.04 自带 nouveau显卡驱动，这个自带的驱动是不能用于CUDA的，需要卸载重装。假如重装过显卡驱动则可跳过这一步。没有重装过的就跟着我的步骤往下走。</p>
<p>首先得禁用Ubuntu自带的显卡驱动nouveau，只有在禁用掉 nouveau 后才能顺利安装 NVIDIA 显卡驱动，禁用方法就是在 <code>/etc/modprobe.d/blacklist-nouveau.conf</code>文件中添加一条禁用命令，首先需要打开该文件，通过以下命令打开：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist-nouveau.conf</span><br></pre></td></tr></table></figure></p>
<p>打开后发现该文件中没有任何内容，<strong>写入</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacklist nouveau  </span><br><span class="line">options nouveau modeset=0</span><br></pre></td></tr></table></figure></p>
<p>保存后关闭文件，注意此时还需执行以下命令使禁用 nouveau 真正生效：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-initramfs -u</span><br></pre></td></tr></table></figure></p>
<p>然后输入以下命令，若什么都没有显示则禁用nouveau生效了(<strong>重启电脑有可能会出现黑屏，原因是禁用了集成显卡，系统没有显卡驱动</strong>)：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nouveau</span><br></pre></td></tr></table></figure></p>
<h2 id="安装NVIDIA官方显卡驱动"><a href="#安装NVIDIA官方显卡驱动" class="headerlink" title="安装NVIDIA官方显卡驱动"></a>安装NVIDIA官方显卡驱动</h2><p>通过<code>Ctrl + Alt + F1</code>进入文本模式，输入帐号密码登录，通过<code>Ctrl + Alt + F7</code>可返回图形化模式，在文本模式登录后首先关闭桌面服务：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service lightdm stop</span><br></pre></td></tr></table></figure></p>
<p>这里会要求你输入账户的密码。然后通过<code>Ctrl + Alt + F7</code>发现已无法成功返回图形化模式，说明桌面服务已成功关闭，注意此步对接下来的 NVIDIA 显卡驱动安装尤为重要，必需确保桌面服务已关闭。按<code>Ctrl + Alt + F1</code>再次进入终端命令行界面，先卸载之前的显卡驱动(注意以下命令在<code>Zsh</code>的shell环境下不认识*，需要切换到<code>bash</code>的shell环境)：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge nvidia*</span><br></pre></td></tr></table></figure></p>
<p>加入官方ppa源：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:graphics-drivers/ppa</span><br></pre></td></tr></table></figure></p>
<p>之后刷新软件库并安装显卡驱动：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install nvidia-418 nvidia-settings nvidia-prime  # CUDA 10.1</span><br><span class="line"><span class="meta">#</span><span class="bash">sudo apt-get install nvidia-390 nvidia-settings nvidia-prime  <span class="comment"># cuda 8.0 或 CUDA 9.0</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">sudo apt-get install nvidia-415 nvidia-settings nvidia-prime  <span class="comment"># CUDA 9.0</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>重启电脑</strong>，通过下面命令查看显卡信息：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-settings</span><br></pre></td></tr></table></figure></p>
<h2 id="配置NVIDIA环境变量"><a href="#配置NVIDIA环境变量" class="headerlink" title="配置NVIDIA环境变量"></a>配置NVIDIA环境变量</h2><p>使用 gedit 命令打开配置文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>打开后在<strong>文件最后加入</strong>以下两行内容：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH</span><br><span class="line">export LD_LIBRARY_PATH=/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure></p>
<p>保存并退出，运行以下内容使环境变量生效：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source  ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="查看NVIDIA驱动版本"><a href="#查看NVIDIA驱动版本" class="headerlink" title="查看NVIDIA驱动版本"></a>查看NVIDIA驱动版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/driver/nvidia/version</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/17/搭建深度学习服务器环境/nvidia-driver.png" alt="nvidia driver"><br>或者<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/nvidia-smi.png" alt="nvidia smi">    </p>
<hr>
<h1 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装CUDA</h1><h2 id="安装CUDA步骤"><a href="#安装CUDA步骤" class="headerlink" title="安装CUDA步骤"></a>安装CUDA步骤</h2><p><strong><a href="https://developer.nvidia.com/cuda-toolkit" target="_blank" rel="noopener">推荐下载安装<code>.run</code>格式文件</a>。</strong>  </p>
<ul>
<li><p><strong>安装CUDA9.0以及之前版本</strong><br>  安装完显卡驱动后，<code>CUDA Toolkit</code>和<code>samples</code>可单独安装，直接在终端运行安装，无需进入文本模式：   </p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh cuda_9.0.176_384.81_linux.run --no-opengl-libs</span><br></pre></td></tr></table></figure>
<p>  执行此命令约1分钟后会出现安装协议要你看，刚开始是0%，此时长按回车键让此百分比增长，直到100%，然后按照提示操作即可，先输入 <code>accept</code> ，是否安装显卡驱动选择<code>no</code>:   </p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 387.26?</span><br><span class="line">(y)es/(n)o/(q)uit: n</span><br></pre></td></tr></table></figure>
<p>  其余的一律按<code>默认</code>或者<code>y</code>进行安装即可。    </p>
<p>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda_finished.png" alt="CUDA安装完成">     </p>
<p>  安装结束以后在<code>/usr/local/</code>目录下查看，可以看到不但生成对应版本的<code>cuda-9.0</code>文件夹，还生成一个相应<code>软连接</code>文件夹<code>cuda</code>:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda1.png" alt="cuda1">    </p>
</li>
<li><p><strong>安装CUDA10.1</strong><br>  <em>按照前面安装<a href="#安装NVIDIA官方显卡驱动">NVIDIA驱动</a>方法安装<strong>NVIDIA-418</strong>驱动</em>    </p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 cuda_10.1.105_418.39_linux.run</span><br><span class="line">sudo sh ./cuda_10.1.105_418.39_linux.run</span><br></pre></td></tr></table></figure>
<p>  输入<code>accept</code>进入安装界面:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1_1.png" alt="CUDA 10.1"><br>  <strong>不要安装<code>CUDA</code>自带的<code>NVIDIA</code>驱动</strong>，将光标移动到<code>Driver</code>选项上，按下<strong>空格键</strong>取消选择安装<code>NVIDIA</code>驱动，移动光标再到<code>Install</code>上然后按回车。<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1_2.png" alt="CUDA 1O.1"><br>  若已经安装旧版本的CUDA版本，会出现以下提示，输入yes继续安装即可:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1_install1.png" alt="CUDA 1O.1"><br>  安装成功后提示:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1-finished.png" alt="CUDA success">      </p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">===========</span><br><span class="line">= Summary =</span><br><span class="line">===========</span><br><span class="line"></span><br><span class="line">Driver:   Not Selected</span><br><span class="line">Toolkit:  Installed in /usr/local/cuda-10.1/</span><br><span class="line">Samples:  Installed in /home/andy/, but missing recommended libraries</span><br><span class="line"></span><br><span class="line">Please make sure that</span><br><span class="line">-   PATH includes /usr/local/cuda-10.1/bin</span><br><span class="line">-   LD_LIBRARY_PATH includes /usr/local/cuda-10.1/lib64, or, add /usr/local/cuda-10.1/lib64 to /etc/ld.so.conf and run ldconfig as root</span><br><span class="line"></span><br><span class="line">To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-10.1/bin</span><br><span class="line"></span><br><span class="line">Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-10.1/doc/pdf for detailed information on setting up CUDA.</span><br><span class="line">***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 418.00 is required for CUDA 10.1 functionality to work.</span><br><span class="line">To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:</span><br><span class="line">    sudo &lt;CudaInstaller&gt;.run --silent --driver</span><br><span class="line"></span><br><span class="line">Logfile is /var/log/cuda-installer.log</span><br></pre></td></tr></table></figure>
<p>  安装成功以后在<code>/usr/local/</code>目录下查看，可以看到不但生成对应版本的<code>cuda-10.1</code>文件夹，还生成一个相应<code>软连接</code>文件夹<code>cuda</code>或者将之前cuda9.0生成的<strong>cuda软连接</strong>重新指向cuda10.1文件夹:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1-success.png" alt="CUDA 10.1 Sucessful">     </p>
</li>
</ul>
<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>安装完成后配置<code>CUDA</code>环境变量，使用<code>vim</code>配置文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>在该文件最后加入以下两行并保存：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CUDA</span></span><br><span class="line">export PATH=/usr/local/cuda/bin:$PATH    #/usr/local/cuda和/usr/local/cuda-10.1是同一个文件夹，两者通过软连接相连</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure></p>
<p><strong>使该配置生效：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source  ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p><strong>检验CUDA 是否安装成功</strong>，输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/cuda/samples/1_Utilities/deviceQuery</span><br><span class="line">sudo make</span><br><span class="line">./deviceQuery</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>CUDA 9.0 PASS</strong>:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda9-pass.png" alt="CUDA 9.0 PASS">    </p>
</li>
<li><p><strong>CUDA 10.1 PASS</strong>:<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1-pass.png" alt="CUDA 10.1 PASS">    </p>
</li>
</ul>
<h2 id="查看CUDA版本"><a href="#查看CUDA版本" class="headerlink" title="查看CUDA版本"></a>查看CUDA版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/local/cuda/version.txt</span><br></pre></td></tr></table></figure>
<!-- ![cuda](cuda.png)     -->
<ul>
<li><p>CUDA 9.0<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda9.0-version.png" alt="CUDA 9.0">     </p>
</li>
<li><p>CUDA 10.1<br>  <img src="/2019/03/17/搭建深度学习服务器环境/cuda-version.png" alt="CUDA 10.1">     </p>
</li>
</ul>
<h2 id="卸载CUDA的方法"><a href="#卸载CUDA的方法" class="headerlink" title="卸载CUDA的方法"></a>卸载CUDA的方法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/cuda/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA 9.0</span></span><br><span class="line">sudo ./uninstall_cuda_9.0.pl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA 10.1</span></span><br><span class="line">sudo ./cuda-uninstaller</span><br></pre></td></tr></table></figure>
<p>卸载完成后如果显示：<code>Not removing directory, it is not empty: /usr/local/cuda-9.0</code> ，假如需要重装<code>CUDA 9.0</code>的话就把这个文件夹删除。在<code>/usr/local/</code>路径下输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CUDA 9.0</span></span><br><span class="line">sudo rm -rf cuda-9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA 10.1</span></span><br><span class="line">sudo rm -rf cuda-10.1</span><br></pre></td></tr></table></figure></p>
<h2 id="安装CUDA过程中遇到的问题"><a href="#安装CUDA过程中遇到的问题" class="headerlink" title="安装CUDA过程中遇到的问题"></a>安装CUDA过程中遇到的问题</h2><p><code>CUDA 10.1</code>提示安装失败:<br><img src="/2019/03/17/搭建深度学习服务器环境/cuda-error.png" alt="CUDA Error"><br>查看<code>vim /var/log/cuda-installer.log</code>显示:<br><img src="/2019/03/17/搭建深度学习服务器环境/cuda-error1.png" alt="Error Detail"><br><code>ERROR: You appear to be running an X server; please exit X</code>，是在安装<code>CUDA</code>的时候选择的安装<code>CUDA</code>自带的<code>NVIDIA</code>显卡驱动导致的，解决方法是:<br>(1)在安装<code>CUDA</code>的时候不要选择安装<code>CUDA</code>自带的<code>NVIDIA</code>驱动；<br>(2)若要用<code>CUDA</code>自带的<code>NVIDIA</code>显卡驱动，则<code>Ctrl + Alt + F1</code>在终端命令行进行安装:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service lightdm stop</span><br><span class="line">bash # Switch from zsh environment to bash environment</span><br><span class="line">sudo apt-get purge nvidia*</span><br><span class="line">sudo sh ./cuda_10.1.105_418.39_linux.run</span><br></pre></td></tr></table></figure></p>
<p>若是在终端命令行下安装的CUDA，则需要安装成功后运行:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service lightdm start</span><br></pre></td></tr></table></figure></p>
<p>然后再按通过<code>Ctrl + Alt + F7</code>可返回图形化模式。   </p>
<hr>
<h1 id="安装cuDNN"><a href="#安装cuDNN" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h1><h2 id="下载安装cuDNN"><a href="#下载安装cuDNN" class="headerlink" title="下载安装cuDNN"></a>下载安装cuDNN</h2><p><code>cuDNN</code>要根据<code>CUDA</code>选择相应平台版本，在<code>Ubuntu16.04</code>下(<code>Ubuntu</code>其他版本类似)到<a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener">cuDNN官网</a><strong>推荐下载安装<code>.tgz</code>格式的文件</strong>, 不推荐下载安装<code>.deb</code>格式，若误装了<code>.deb</code>格式的cuDNN请用以下命令进行卸载:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l |grep -i libcudnn* # 查看.deb安装的cudnn</span><br><span class="line">sudo apt-get purge libcudnn×</span><br><span class="line">```    </span><br><span class="line">下面以安装**cuDNN v7.5.0**为例安装，其他版本类似，只需要将版本号改一下即可:    </span><br><span class="line">![cuDNN Download](cudnn.png)      </span><br><span class="line"></span><br><span class="line">解压`cudnn-10.1-linux-x64-v7.5.0.56.tgz`到当前文件夹，得到一个`cuda`文件夹，该文件夹下有`include`和 `lib64`两个文件夹:    </span><br><span class="line">![cuDNN folder](cuDNN-folder.png)      </span><br><span class="line"></span><br><span class="line">**若安装了多个`CUDA`版本，要特别注意`/usr/local/cuda`软连接到了哪个版本的`CUDA`。**    </span><br><span class="line"></span><br><span class="line">命令行进入其中的`include`文件夹路径下，然后进行以下操作：</span><br><span class="line">```shell</span><br><span class="line">cd ~/Download/cuda/include/</span><br><span class="line">sudo cp cudnn.h /usr/local/cuda/include/ #复制头文件</span><br></pre></td></tr></table></figure></p>
<p>然后命令行进入<code>cuda/lib64</code>文件夹路径下(其实<code>cuda/lib64</code>文件夹下通过Beyond Compare查看，<code>libcudnn.so</code>、<code>libcudnn.so.7</code>和<code>libcudnn.so.7.5.0</code>是同一个文件的不同扩展名)，运行以下命令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Download/cuda/lib64/</span><br><span class="line">sudo cp lib* /usr/local/cuda/lib64/ #复制动态链接库</span><br><span class="line">sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*</span><br><span class="line">cd /usr/local/cuda/lib64/</span><br><span class="line">sudo rm -rf libcudnn.so libcudnn.so.7  #删除原有动态文件</span><br><span class="line">sudo ln -s libcudnn.so.7.5.0 libcudnn.so.7  #生成软链接</span><br><span class="line">sudo ln -s libcudnn.so.7 libcudnn.so  #生成软链接</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/cudnn1.png" alt="cudnn1">    </p>
<p>随后需要将路径<code>/usr/local/cuda/lib64</code>添加到动态库，分两步：<br>1）安装<code>vim</code>, 输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vim-gtk</span><br></pre></td></tr></table></figure></p>
<p>2）<strong>配置</strong>，输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ld.so.conf.d/cuda.conf</span><br></pre></td></tr></table></figure></p>
<p><strong>编辑状态</strong>下，输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/cuda/lib64</span><br></pre></td></tr></table></figure></p>
<p>保存退出，输入下面代码使其<strong>生效</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></p>
<p>安装完成后可用<code>nvcc -V</code>命令验证是否安装成功，若出现以下信息则表示安装成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2019 NVIDIA Corporation</span><br><span class="line">Built on Fri_Feb__8_19:08:17_PST_2019</span><br><span class="line">Cuda compilation tools, release 10.1, V10.1.105</span><br></pre></td></tr></table></figure></p>
<p>查看<code>cuDNN</code>版本:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/cudnn2.png" alt="cudnn2">     </p>
<h2 id="cuDNN常见问题"><a href="#cuDNN常见问题" class="headerlink" title="cuDNN常见问题"></a>cuDNN常见问题</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error : Failed to get convolution algorithm. </span><br><span class="line">This is probably because cuDNN failed to initialize, </span><br><span class="line">so try looking to see if a warning log message was printed above.</span><br></pre></td></tr></table></figure>
<p>出现上述问题是安装的<code>cuDNN</code>版本跟<code>CUDA</code>和<code>TensorFlow</code>相兼容的版本不符合，重新安装指定版本的<code>cuDNN</code>即可。    </p>
<p><strong>参考资料</strong>    </p>
<blockquote>
<p><a href="https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#installlinux" target="_blank" rel="noopener">cuDNN官方安装指导</a>     </p>
</blockquote>
<hr>
<h1 id="CUDA多版本问题"><a href="#CUDA多版本问题" class="headerlink" title="CUDA多版本问题"></a>CUDA多版本问题</h1><p>在实验的时候有些算法跟当前生效(安装)的<code>CUDA</code>和<code>cuDNN</code>版本不一致，所以需要同时安装多个版本，这里就是解决同时管理多个<code>CUDA</code>版本问题.   </p>
<ol>
<li>首先按照上述介绍的<a href="#安装cuda">安装CUDA</a>和对应版本的<a href="#安装cudnn">安装cuDNN</a>，安装实验环境依赖的版本；</li>
<li>默认<code>/usr/local/cuda</code>是<strong>软连接</strong>到<strong>最新安装的<code>CUDA</code>文件夹</strong>上的:<br> <img src="/2019/03/17/搭建深度学习服务器环境/cuda10.1-success.png" alt="cuda2">    </li>
<li><p>删除已经软连接的<code>/usr/local/cuda</code>，将需要的<code>CUDA-X.0安装文件夹</code>软连接到<code>/usr/local/cuda</code>上, 例如需要<code>CUDA 9.0</code>这个版本:      </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    cd /usr/local/</span><br><span class="line">    sudo rm cuda</span><br><span class="line">    sudo ln -s /usr/local/cuda-9.0 /usr/local/cuda</span><br><span class="line">    ```    </span><br><span class="line">    ![cuda3](cuda9-cuda10.1.png)       </span><br><span class="line">4. 由于在安装`CUDA`的时候已经将`cuda`加入了环境变量，所以不用再加入了。   </span><br><span class="line">5. 查看`CUDA`版本   </span><br><span class="line">    ```shell</span><br><span class="line">    cat /usr/local/cuda/version.txt</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/03/17/搭建深度学习服务器环境/cuda9.0-version.png" alt="cuda">     </p>
</li>
</ol>
<hr>
<h1 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h1><h2 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h2><p>下载<code>Anaconda</code>的<code>sh</code>文件<code>Anaconda3-5.2.0-Linux-x86_64.sh</code>，然后运行以下代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x ./Anaconda3-5.2.0-Linux-x86_64.sh <span class="comment">#chmod 777 ./Anaconda3-5.2.0-Linux-x86_64.sh</span></span><br><span class="line">bash Anaconda3-5.2.0-Linux-x86_64.sh</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 Anaconda3-5.3.1-Linux-x86_64.sh</span><br><span class="line">bash Anaconda3-5.3.1-Linux-x86_64.sh</span><br></pre></td></tr></table></figure></p>
<p><strong><code>conda install -c menpo opencv3</code>命令有时候会显示权限不够<code>permission issue</code>。这是因为你安装<code>anaconda</code>时用的是<code>sudo</code>，这时候需要修改<code>anaconda3</code>文件夹权限</strong>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R 你的用户名 /home/你的用户名/anaconda3</span><br></pre></td></tr></table></figure></p>
<h2 id="屏蔽Anaconda"><a href="#屏蔽Anaconda" class="headerlink" title="屏蔽Anaconda"></a>屏蔽Anaconda</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>然后屏蔽后的结果如下：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># added by Anaconda3 <span class="number">5.3</span>.<span class="number">1</span> installer</span><br><span class="line">#export PATH=<span class="string">"/home/andy/anaconda3/bin:$PATH"</span></span><br><span class="line">#export LD_LIBRARY_PATH=~/anaconda3/li<span class="variable">b:</span>$LD_LIBRARY_PATH</span><br><span class="line">#export CPLUS_INCLUDE_PATH=~/anaconda3/include/<span class="keyword">python3</span>.<span class="number">6</span><span class="keyword">m</span></span><br></pre></td></tr></table></figure></p>
<p>其实这里涉及到<code>linux可执行程序搜索路径</code>的问题，上述<code>PATH=&quot;/home/andy/anaconda3/bin:$PATH&quot;</code>将<code>/home/andy/anaconda3/bin</code>放在了原始的<code>$PATH</code>前面，这样系统在执行的时候首先检查要可执行文件是否在<code>/home/andy/anaconda3/bin</code>中，然后再从<code>$PATH</code>中搜索，理解了这个关系，上述代码可以改为，这样改了以后将不需要<a href="#重建anaconda软连接">重建Anaconda软连接</a>这一步操作了:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># added by Anaconda3 <span class="number">5.3</span>.<span class="number">1</span> installer</span><br><span class="line">export PATH=<span class="string">"$PATH：/home/andy/anaconda3/bin"</span></span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH：~/anaconda3/lib</span><br><span class="line">export CPLUS_INCLUDE_PATH=~/anaconda3/include/<span class="keyword">python3</span>.<span class="number">6</span><span class="keyword">m</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Anaconda最新版屏蔽如下</strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># added by Anaconda3 <span class="number">5.3</span>.<span class="number">1</span> installer</span><br><span class="line"># &gt;&gt;&gt; conda init &gt;&gt;&gt;</span><br><span class="line"># !! Contents within this block are managed by <span class="string">'conda init'</span> !!</span><br><span class="line">#__conda_setup=<span class="string">"$(CONDA_REPORT_ERRORS=false '/home/andy/anaconda3/bin/conda' shell.bash hook 2&gt; /dev/null)"</span></span><br><span class="line">#if [ $? -eq 0 ]; then</span><br><span class="line">#    \<span class="built_in">eval</span> <span class="string">"$__conda_setup"</span></span><br><span class="line">#else</span><br><span class="line">#    if [ -f "/home/andy/anaconda3/etc/profile.d/conda.sh" ]; then</span><br><span class="line">#        . <span class="string">"/home/andy/anaconda3/etc/profile.d/conda.sh"</span></span><br><span class="line">#        CONDA_CHANGEPS1=false conda activate base</span><br><span class="line">#    <span class="keyword">else</span></span><br><span class="line">#        \export PATH=<span class="string">"/home/andy/anaconda3/bin:$PATH"</span></span><br><span class="line">#    fi</span><br><span class="line">#fi</span><br><span class="line">#unset __conda_setup</span><br><span class="line"># &lt;&lt;&lt; conda init &lt;&lt;&lt;</span><br></pre></td></tr></table></figure></p>
<p>最后命令行输入以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p><strong>必须重启电脑</strong>    </p>
<h2 id="重建Anaconda软连接"><a href="#重建Anaconda软连接" class="headerlink" title="重建Anaconda软连接"></a>重建Anaconda软连接</h2><p><strong>重建原理</strong><br>由于linux系统默认搜索可执行文件的顺序为<code>/bin</code> -&gt; <code>/usr/bin</code> -&gt; <code>/usr/local/bin</code> ，而前两个为系统的可执行文件存放的地方，<code>/usr/local/bin</code>为用户自定义的可执行文件存放区，所以只需要将<code>Anaconda</code>的<code>~/anaconda3/bin/可执行文件</code><strong>软连接</strong>到<code>/usr/local/bin</code>即可。    </p>
<p>当需要<strong>重新使用<code>Anaconda</code>的时候</strong>，只需要将<code>Anaconda</code>的执行文件<strong>软连接</strong>到<code>/usr/local/bin</code>里，注意<strong>这里要用绝对路径，否则不起作用</strong>，如：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ln  -s  /home/andy/anaconda3/bin/conda  /usr/local/bin/conda</span><br><span class="line">sudo ln  -s  /home/andy/anaconda3/bin/activate  /usr/local/bin/activate</span><br><span class="line">sudo ln  -s  /home/andy/anaconda3/bin/deactivate  /usr/local/bin/deactivate</span><br></pre></td></tr></table></figure></p>
<p>首先注意<code>usr</code> 指 <code>Unix System Resource</code>，而不是<code>User</code>,    </p>
<ul>
<li><code>/usr/bin</code>下面的都是系统预装的可执行程序，会随着系统升级而改变    </li>
<li><code>/usr/local/bin</code>目录是给用户放置自己的可执行程序的地方，推荐放在这里，不会被系统升级而覆盖同名文件    </li>
</ul>
<p><strong>软连接后使用</strong>时：<br>首先用以下命令查看anaconda环境(自带为base):<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env list</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/conda1.png" alt="conda list">    </p>
<p><strong>激活环境用：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate [env name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">source activate [env name]</span><br></pre></td></tr></table></figure></p>
<p><strong>注意:</strong> 上面<code>[env name]</code>用具体的环境名代替，如<code>conda activate base</code>.<br><img src="/2019/03/17/搭建深度学习服务器环境/conda2.png" alt="conda list">    </p>
<p><strong>取消激活环境用：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda deactivate</span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">source deactivate</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/conda3.png" alt="conda list">    </p>
<h2 id="Anaconda虚拟环境"><a href="#Anaconda虚拟环境" class="headerlink" title="Anaconda虚拟环境"></a>Anaconda虚拟环境</h2><p><strong>创建新的虚拟环境</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n venv python=3.6 # select python version</span><br></pre></td></tr></table></figure></p>
<p><strong>激活虚拟环境</strong>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source activate venv</span><br></pre></td></tr></table></figure></p>
<p><strong>删除虚拟环境</strong>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env remove -n venv</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="安装opencv"><a href="#安装opencv" class="headerlink" title="安装opencv"></a>安装opencv</h1><h2 id="下载OpenCV"><a href="#下载OpenCV" class="headerlink" title="下载OpenCV"></a>下载OpenCV</h2><p>进入官网 : <a href="http://opencv.org/releases.html" target="_blank" rel="noopener">http://opencv.org/releases.html</a> 或者 <a href="https://github.com/opencv/opencv/releases" target="_blank" rel="noopener">https://github.com/opencv/opencv/releases</a>, 选择 需要的 <code>x.x.x.zip</code>版本, 下载 <code>opencv-x.x.x.zip</code> :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line">wget https://github.com/opencv/opencv/archive/x.x.x.zip</span><br><span class="line">chmod 777 x.x.x.zip</span><br><span class="line">unzip x.x.x.zip</span><br></pre></td></tr></table></figure></p>
<h2 id="编译OpenCV"><a href="#编译OpenCV" class="headerlink" title="编译OpenCV"></a>编译OpenCV</h2><p>随后解压到你要安装的位置，命令行进入已解压的文件夹 <code>opencv-x.x.x</code> 目录下，执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd opencv-x.x.x</span><br><span class="line">mkdir build # 创建编译的文件目录</span><br><span class="line">cd build</span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/local -DBUILD_JPEG=ON -DBUILD_TIFF=ON -DBUILD_PNG=ON ..</span><br><span class="line">make -j8  #编译</span><br></pre></td></tr></table></figure></p>
<p><strong>遇到一下报错信息有两种可能：</strong><br><img src="/2019/03/17/搭建深度学习服务器环境/opencv-error1.png" alt="编译报错">    </p>
<ul>
<li><p>在编译<code>opencv3.4.0</code>源码的时候，会下载诸如<code>ippicv_2017u3_lnx_intel64_20170822.tgz</code>的压缩包，如果下载失败，请<a href="opencv/opencv-3.4.0-dev.cache.zip">下载离线包</a>，解压该文件，会得到<code>.cache</code>文件夹，用此文件夹覆盖<code>opencv</code>源码文件夹下的<code>.cache</code>文件夹，再重新编译即可。<code>.cahce</code>文件夹为隐藏文件，可用<code>ctrl+h</code>查看。</p>
</li>
<li><p>若本机里安装了<strong>Anaconda</strong>，<strong>推荐<a href="#屏蔽anaconda">屏蔽Anaconda</a></strong>，否则需要在<code>~/.bashrc</code> 或 <code>~/.zshrc</code>中加入：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> added by Anaconda3 installer</span></span><br><span class="line">export PATH="/home/andy/anaconda3/bin:$PATH"</span><br><span class="line">export LD_LIBRARY_PATH=~/anaconda3/lib:$LD_LIBRARY_PATH</span><br><span class="line">export CPLUS_INCLUDE_PATH=~/anaconda3/include/python3.6m</span><br><span class="line">export PATH="$PATH:$HOME/bin"</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在<code>98%</code>的时候会等很久很久，属于正常现象。</p>
<h2 id="安装OpenCV"><a href="#安装OpenCV" class="headerlink" title="安装OpenCV"></a>安装OpenCV</h2><p>编译成功后安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make install <span class="comment">#安装</span></span><br></pre></td></tr></table></figure></p>
<p>运行以下命令刷新<code>opencv</code>动态链接库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></p>
<p>安装完成后通过查看 <code>opencv</code> 版本验证是否安装成功：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg-config --modversion opencv</span><br></pre></td></tr></table></figure></p>
<p><strong>若运行以上命令提示一下错误</strong>：<br><img src="/2019/03/17/搭建深度学习服务器环境/opencv-error2.png" alt="编译报错"><br><strong>临时解决方法</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=/usr/<span class="built_in">local</span>/lib/pkgconfig</span><br><span class="line">```   </span><br><span class="line">**彻底解决方法**    </span><br><span class="line">接下来要给系统加入`opencv`库的环境变量:    </span><br><span class="line">用`gedit`打开`/etc/ld.so.conf`，注意要用sudo打开获得权限，不然无法修改， 如：</span><br><span class="line">```shell</span><br><span class="line">sudo gedit /etc/ld.so.conf</span><br></pre></td></tr></table></figure></p>
<p>在文件中加上一行:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib</span><br></pre></td></tr></table></figure></p>
<p><code>/user/local</code>是<code>opencv</code>安装路径 就是<code>makefile</code>中指定的安装路径。    </p>
<p>再运行:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>bash</strong>    </p>
<ul>
<li><p><strong>所有用户</strong><br>修改<code>/etc/bash.bashrc</code>文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/bash.bashrc</span><br></pre></td></tr></table></figure>
<p>在文件末尾加入： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure>
<p>运行<code>source /etc/bash.bashrc</code>使其生效。    </p>
</li>
<li><p><strong>当前用户</strong><br>修改<code>~/.bashrc</code>文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>在文件末尾加入： </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure>
<p>运行<code>source ~/.bashrc</code>使其生效。    </p>
</li>
</ul>
</li>
<li><p><strong>zsh</strong>    </p>
<ul>
<li><p><strong>所有用户</strong>    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zsh/zprofile</span><br></pre></td></tr></table></figure>
<p>然后加入以下内容:   </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure>
<p>运行<code>source /etc/zsh/zprofile</code>使其生效。</p>
</li>
<li><p><strong>当前用户</strong>    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure>
<p>然后加入以下内容:   </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure>
<p>运行<code>source ~/.zshrc</code>使其生效。</p>
</li>
</ul>
</li>
</ul>
<h2 id="卸载OpenCV"><a href="#卸载OpenCV" class="headerlink" title="卸载OpenCV"></a>卸载OpenCV</h2><p>进入<code>OpenCV</code>解压文件夹中的<code>buid</code>文件夹：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $HOME/opencv-x.x.x/build</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make uninstall</span><br></pre></td></tr></table></figure></p>
<p>然后把整个<code>opencv-x.x.x</code>文件夹都删掉。随后再运行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -r /usr/local/include/opencv2 /usr/local/include/opencv \</span><br><span class="line">/usr/include/opencv /usr/include/opencv2 /usr/local/share/opencv \</span><br><span class="line">/usr/local/share/OpenCV /usr/share/opencv /usr/share/OpenCV \</span><br><span class="line">/usr/local/bin/opencv* /usr/local/lib/libopencv</span><br></pre></td></tr></table></figure></p>
<p>把一些残余的动态链接文件和空文件夹删掉。有些文件夹已经被删掉了所以会找不到路径。    </p>
<hr>
<h1 id="TensorRT"><a href="#TensorRT" class="headerlink" title="TensorRT"></a>TensorRT</h1><h2 id="安装TensorRT"><a href="#安装TensorRT" class="headerlink" title="安装TensorRT"></a>安装TensorRT</h2><blockquote>
<p><a href="https://docs.nvidia.com/deeplearning/sdk/tensorrt-install-guide/index.html" target="_blank" rel="noopener">TensorRT官方安装指南</a>    </p>
</blockquote>
<h3 id="TensorRT环境变量设置"><a href="#TensorRT环境变量设置" class="headerlink" title="TensorRT环境变量设置"></a>TensorRT环境变量设置</h3><p>首先<a href="https://developer.nvidia.com/nvidia-tensorrt-download" target="_blank" rel="noopener">下载<strong>tar</strong>版本的安装包</a>，需要登陆NVIDIA账号。<br>安装<code>TensorRT</code>前需要<a href="#安装cuda">安装<code>Cuda</code></a>和<a href="#安装cudnn">安装<code>cudnn</code></a>，安装步骤可以参考上方。<br>打开下载的<code>TensorRT</code>所在路径，解压下载的<code>tar</code>文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 TensorRT-XXX.tar.gz</span><br><span class="line">tar -xzvf TensorRT-XXX.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>将加压后的<code>TensorRT-XXX</code>文件夹移动到<code>HOME</code>目录下，并创建软连接，这样可以安装多个版本的<code>TensorRT-XXX</code>，在切换的时候只需要将用到的<code>TensorRT-XXX</code>版本软连接到<code>TensorRT</code>上就可以了:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mv TensorRT-XXX  ~/TensorRT-XXX</span><br><span class="line">cd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create Symbol Link</span></span><br><span class="line">ln -s ~/TensorRT-XXX  TensorRT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TensorRT 3</span></span><br><span class="line">sudo ln -s ~/TensorRT/bin/giexec /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TensorRT &gt;= 4</span></span><br><span class="line">sudo ln -s ~/TensorRT/bin/trtexec /usr/local/bin/</span><br></pre></td></tr></table></figure></p>
<p>然后设置<strong>环境变量</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bash</span></span><br><span class="line">vim ~/.bashrc # 打开环境变量文件</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> zsh</span></span><br><span class="line">vim ~/.zshrc # 打开环境变量文件</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将下面三个环境变量写入环境变量文件并保存</span></span><br><span class="line">export LD_LIBRARY_PATH=~/TensorRT/lib:$LD_LIBRARY_PATH</span><br><span class="line">export CUDA_INSTALL_DIR=/usr/local/cuda</span><br><span class="line">export CUDNN_INSTALL_DIR=/usr/local/cuda</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bash</span></span><br><span class="line">source ~/.bashrc   # 使刚刚修改的环境变量文件生效</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> zsh</span></span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>
<h3 id="安装Python的TensorRT包"><a href="#安装Python的TensorRT包" class="headerlink" title="安装Python的TensorRT包"></a>安装Python的TensorRT包</h3><p>进到解压后的<code>TensorRT</code>的<strong>Python</strong>文件下：   </p>
<h4 id="非虚拟环境下"><a href="#非虚拟环境下" class="headerlink" title="非虚拟环境下"></a>非虚拟环境下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/TensorRT/python/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">sudo pip2 install tensorrt-XXX-cp27-cp27mu-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">sudo pip3 install tensorrt-XXX-cp35-cp35m-linux_x86_64.whl</span><br></pre></td></tr></table></figure>
<p>或者：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> TensorRT/python/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">pip2 install tensorrt-XXX-cp27-cp27mu-linux_x86_64.whl --user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">pip3 install tensorrt-XXX-cp35-cp35m-linux_x86_64.whl --user</span><br></pre></td></tr></table></figure></p>
<h4 id="虚拟环境下"><a href="#虚拟环境下" class="headerlink" title="虚拟环境下"></a>虚拟环境下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span>  activate venv</span><br><span class="line"><span class="built_in">cd</span> TensorRT/python/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">pip install tensorrt-XXX-cp27-cp27mu-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">pip install tensorrt-XXX-cp35-cp35m-linux_x86_64.whl</span><br></pre></td></tr></table></figure>
<p><strong>如安装失败请参考<a href="#安装过程中遇到的问题以及解决方法">安装过程中遇到的问题以及解决方法</a>。</strong>   </p>
<h3 id="安装uff"><a href="#安装uff" class="headerlink" title="安装uff"></a>安装uff</h3><p>转到<strong>uff</strong>目录下安装<code>uff</code>文件夹下安装：   </p>
<h4 id="非虚拟环境下-1"><a href="#非虚拟环境下-1" class="headerlink" title="非虚拟环境下"></a>非虚拟环境下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/TensorRT/uff/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">sudo pip2 install uff-XXX-py2.py3-none-any.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">sudo pip3 install uff-XXX-py2.py3-none-any.whl</span><br></pre></td></tr></table></figure>
<p>或者：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> TensorRT/uff/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">pip2 install uff-XXX-py2.py3-none-any --user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">pip3 install uff-XXX-py2.py3-none-any --user</span><br></pre></td></tr></table></figure></p>
<h4 id="虚拟环境下-1"><a href="#虚拟环境下-1" class="headerlink" title="虚拟环境下"></a>虚拟环境下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span>  activate venv</span><br><span class="line"><span class="built_in">cd</span> TensorRT/uff/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python2</span></span><br><span class="line">pip install uff-XXX-py2.py3-none-any.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于python3</span></span><br><span class="line">pip install uff-XXX-py2.py3-none-any.whl</span><br></pre></td></tr></table></figure>
<h3 id="验证TensorRT是否安装成功"><a href="#验证TensorRT是否安装成功" class="headerlink" title="验证TensorRT是否安装成功"></a>验证TensorRT是否安装成功</h3><p><strong>测试TensorRT是否安装成功</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> tensorrt</span><br></pre></td></tr></table></figure></p>
<p>会输出<code>TensorRT</code>的安装路径:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/tensorrt</span><br></pre></td></tr></table></figure></p>
<p><strong>测试uff是否安装成功</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> convert-to-uff</span><br></pre></td></tr></table></figure></p>
<p>会输出<code>uff</code>的安装路径:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/convert-to-uff</span><br></pre></td></tr></table></figure></p>
<p>拷贝<code>lenet5.uff</code>到python相关目录进行验证：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo cp TensorRT/data/mnist/lenet5.uff TensorRT/python/data/mnist/lenet5.uff</span><br><span class="line"><span class="built_in">cd</span> TensorRT/samples/sampleMNIST</span><br><span class="line">make clean</span><br><span class="line">make</span><br><span class="line"><span class="built_in">cd</span> /TensorRT/bin（转到bin目录下面，make后的可执行文件在此目录下）</span><br><span class="line">./sample_mnist</span><br></pre></td></tr></table></figure></p>
<p>命令执行顺利即安装成功。   </p>
<h3 id="TensorRT安装过程中遇到的问题以及解决方法"><a href="#TensorRT安装过程中遇到的问题以及解决方法" class="headerlink" title="TensorRT安装过程中遇到的问题以及解决方法"></a>TensorRT安装过程中遇到的问题以及解决方法</h3><h4 id="在安装Python的TensorRT包时可能出现的错误"><a href="#在安装Python的TensorRT包时可能出现的错误" class="headerlink" title="在安装Python的TensorRT包时可能出现的错误"></a>在安装<code>Python</code>的<code>TensorRT</code>包时可能出现的错误</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In file included from src/cpp/cuda.cpp:1:0:</span><br><span class="line">src/cpp/cuda.hpp:14:18: fatal error: cuda.h: No such file or directory</span><br><span class="line">compilation terminated.</span><br><span class="line">error: <span class="built_in">command</span> <span class="string">'x86_64-linux-gnu-gcc'</span> failed with <span class="built_in">exit</span> status 1</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/17/搭建深度学习服务器环境/tensorrt_error.png" alt="TensorRT报错"><br><strong>原因</strong><br>显示是找不到cuda.h，根据网上分析是因为用了sudo之后环境变量用的是root的环境变量。    </p>
<p><strong>解决方案</strong><br>将cuda的安装路径添加到root的环境变量中，在root角色下安装Python的TensorRT包:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/profile.d/cuda.sh</span><br><span class="line">``` </span><br><span class="line">添加：  </span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">export PATH=/usr/local/cuda/bin:$PATH</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo su -</span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于python2</span></span><br><span class="line">pip2 install tensorrt-XXX-cp27-cp27mu-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于python3</span></span><br><span class="line">pip3 install tensorrt-XXX-cp35-cp35m-linux_x86_64.whl</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h4 id="Python导入tensorrt或者tensorflow的时候提示ImportError-numpy-core-multiarray-failed-to-import"><a href="#Python导入tensorrt或者tensorflow的时候提示ImportError-numpy-core-multiarray-failed-to-import" class="headerlink" title="Python导入tensorrt或者tensorflow的时候提示ImportError: numpy.core.multiarray failed to import"></a><code>Python</code>导入<code>tensorrt</code>或者<code>tensorflow</code>的时候提示<code>ImportError: numpy.core.multiarray failed to import</code></h4><p><strong>解决方法</strong>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U numpy</span><br></pre></td></tr></table></figure></p>
<h2 id="TensorRT生成Engine"><a href="#TensorRT生成Engine" class="headerlink" title="TensorRT生成Engine"></a>TensorRT生成Engine</h2><h3 id="Caffe模型用TensorRT生成Engine"><a href="#Caffe模型用TensorRT生成Engine" class="headerlink" title="Caffe模型用TensorRT生成Engine"></a>Caffe模型用TensorRT生成Engine</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/TensorRT/bin/giexec \</span><br><span class="line">--deploy=path_to_prototxt/intputdeploy.prototxt \</span><br><span class="line">--output=prob \</span><br><span class="line">--model=path_to_caffemodel/caffeModelName.caffemodel \</span><br><span class="line">--engine=path_to_output_engine/outputEngineName.engine</span><br></pre></td></tr></table></figure>
<h3 id="Tensorflow模型用TensorRT生成Engine"><a href="#Tensorflow模型用TensorRT生成Engine" class="headerlink" title="Tensorflow模型用TensorRT生成Engine"></a>Tensorflow模型用TensorRT生成Engine</h3><p>源码文件在<a href="tensorrt/tools"><code>src/tensorrt/tools</code></a>中。     </p>
<p>首先将<code>TensorFlow</code>模型生成<code>uff</code>文件，然后再将<code>uff</code>文件转为<code>engine</code>:    </p>
<h4 id="将TensorFlow模型生成UFF文件"><a href="#将TensorFlow模型生成UFF文件" class="headerlink" title="将TensorFlow模型生成UFF文件"></a>将TensorFlow模型生成UFF文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author : Andy Liu</span></span><br><span class="line"><span class="comment"># Last modified: 2019-03-15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script is used to convert tensorflow model file to uff file</span></span><br><span class="line"><span class="comment"># Using: </span></span><br><span class="line"><span class="comment">#        python tf_to_uff.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uff</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorrt <span class="keyword">as</span> trt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'CUDA_VISIBLE_DEVICES'</span>] = <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line">ckpt_path = <span class="string">"model/model.ckpt"</span></span><br><span class="line">forzen_model_path = <span class="string">"model/frozen_graphs/frozen_graph.pb"</span></span><br><span class="line">uff_path = <span class="string">"model/uff/model.uff"</span></span><br><span class="line"></span><br><span class="line">frozen_input_name = <span class="string">"input"</span></span><br><span class="line">net_input_shape = (<span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line">frozen_output_names = [<span class="string">"fc_3/frozen"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getChatBotModel</span><span class="params">(ckpt_path)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">        sess.run(tf.global_variables_initializer())</span><br><span class="line">        saver = tf.train.import_meta_graph(ckpt_path+<span class="string">'.meta'</span>)</span><br><span class="line">        saver.restore(sess, ckpt_path)</span><br><span class="line">        graph = tf.get_default_graph().as_graph_def()</span><br><span class="line">        <span class="comment">#graph = tf.get_default_graph()</span></span><br><span class="line">        <span class="comment">#print('graph list:', graph.get_operations())</span></span><br><span class="line">        frozen_graph = tf.graph_util.convert_variables_to_constants(sess, graph, frozen_output_names)</span><br><span class="line">        <span class="keyword">return</span> tf.graph_util.remove_training_nodes(frozen_graph)</span><br><span class="line"></span><br><span class="line">tf_model = getChatBotModel(ckpt_path)</span><br><span class="line"><span class="keyword">with</span> tf.gfile.FastGFile(forzen_model_path, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(tf_model.SerializeToString())</span><br><span class="line"><span class="comment">#uff_model = uff.from_tensorflow(tf_model, output_nodes=frozen_output_names, output_filename=uff_path, text=True)</span></span><br><span class="line">uff_model = uff.from_tensorflow_frozen_model(forzen_model_path, output_nodes=frozen_output_names, output_filename=uff_path, text=<span class="keyword">True</span>)</span><br><span class="line">print(<span class="string">'Success! UFF file is in '</span>, os.path.abspath(uff_path))</span><br></pre></td></tr></table></figure>
<h4 id="将UFF文件转为Engine"><a href="#将UFF文件转为Engine" class="headerlink" title="将UFF文件转为Engine"></a>将UFF文件转为Engine</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author : Andy Liu</span></span><br><span class="line"><span class="comment"># Last modified: 2019-03-15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script is used to convert .uff file to .engine for TX2/PX2 or other NVIDIA Platform</span></span><br><span class="line"><span class="comment"># Using: </span></span><br><span class="line"><span class="comment">#        python uff_to_engine.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># import tensorflow as tf</span></span><br><span class="line"><span class="keyword">import</span> tensorrt <span class="keyword">as</span> trt</span><br><span class="line"><span class="keyword">from</span> tensorrt.parsers <span class="keyword">import</span> uffparser</span><br><span class="line"><span class="keyword">import</span> uff</span><br><span class="line"></span><br><span class="line">print(<span class="string">"TensorRT version = "</span>, trt.__version__)</span><br><span class="line">os.environ[<span class="string">'CUDA_VISIBLE_DEVICES'</span>] = <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line">frozen_input_name = <span class="string">"input"</span></span><br><span class="line">net_input_shape = (<span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line">frozen_output_name = <span class="string">"fc_3/frozen"</span></span><br><span class="line">uff_path = <span class="string">'model.uff'</span></span><br><span class="line">engine_path = <span class="string">"model.engine"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uff2engine</span><span class="params">(frozen_input_name, net_input_shape,frozen_output_name,uff_path,engine_path)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(uff_path, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        uff_model = f.read()</span><br><span class="line">        G_LOGGER = trt.infer.ConsoleLogger(trt.infer.LogSeverity.ERROR)</span><br><span class="line">        parser = uffparser.create_uff_parser()</span><br><span class="line">        parser.register_input(frozen_input_name, net_input_shape, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># parser.register_input("input", (3, 128, 128), 0)</span></span><br><span class="line">        parser.register_output(frozen_output_name)</span><br><span class="line">        engine = trt.utils.uff_to_trt_engine(G_LOGGER, uff_model, parser, <span class="number">1</span>, <span class="number">1</span>&lt;&lt;<span class="number">20</span> )</span><br><span class="line">        parser.destroy()</span><br><span class="line">        trt.utils.write_engine_to_file(engine_path, engine.serialize())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    engine_dir = os.path.dirname(engine_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(engine_dir) <span class="keyword">and</span> <span class="keyword">not</span> engine_dir == <span class="string">'.'</span> <span class="keyword">and</span> <span class="keyword">not</span> engine_dir ==<span class="string">''</span>:</span><br><span class="line">        print(<span class="string">"Warning !!! %s is not exists, now has create "</span>%engine_dir)</span><br><span class="line">        os.makedirs(engine_dir)</span><br><span class="line"></span><br><span class="line">    uff2engine(frozen_input_name, net_input_shape,frozen_output_name,uff_path,engine_path)</span><br><span class="line">    print(<span class="string">"Success! Engine file has saved in "</span>, os.path.abspath(engine_path))</span><br></pre></td></tr></table></figure>
<h4 id="调用Engine进行推理"><a href="#调用Engine进行推理" class="headerlink" title="调用Engine进行推理"></a>调用Engine进行推理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># import tensorflow as tf</span></span><br><span class="line"><span class="keyword">import</span> tensorrt <span class="keyword">as</span> trt</span><br><span class="line"><span class="keyword">from</span> tensorrt.parsers <span class="keyword">import</span> uffparser</span><br><span class="line"><span class="keyword">import</span> pycuda.driver <span class="keyword">as</span> cuda</span><br><span class="line"><span class="comment"># import uff</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">IMG_PATH = <span class="string">"./img/1.png"</span></span><br><span class="line">LABEL = <span class="number">1</span></span><br><span class="line">ENGINE_PATH = <span class="string">"./model/engine/model.engine"</span></span><br><span class="line">NET_INPUT_SHAPE = (<span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line">NET_OUTPUT_SHAPE = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize_img</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Normalize image data to [-1,+1]</span></span><br><span class="line"><span class="string">    Arguments:</span></span><br><span class="line"><span class="string">        img: source image</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> (img<span class="number">-128.</span>)/<span class="number">128.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Image</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_image</span><span class="params">(img_path, net_input_shape)</span>:</span></span><br><span class="line">    img = Image.open(img_path)</span><br><span class="line">    img = img.resize(net_input_shape)</span><br><span class="line">    <span class="keyword">return</span> np.asarray(img, dtype=np.float32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">img = load_image(IMG_PATH, NET_INPUT_SHAPE)</span><br><span class="line">img = normalize_img(img)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Engine file</span></span><br><span class="line">G_LOGGER = trt.infer.ConsoleLogger(trt.infer.LogSeverity.ERROR)</span><br><span class="line">engine = trt.utils.load_engine(G_LOGGER, ENGINE_PATH)</span><br><span class="line">context = engine.create_execution_context()</span><br><span class="line">runtime = trt.infer.create_infer_runtime(G_LOGGER)</span><br><span class="line"></span><br><span class="line">output = np.empty(<span class="number">5</span>, dtype = np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Alocate device memory</span></span><br><span class="line">d_input = cuda.mem_alloc(<span class="number">1</span> * img.nbytes)</span><br><span class="line">d_output = cuda.mem_alloc(NET_OUTPUT_SHAPE * output.nbytes)</span><br><span class="line"></span><br><span class="line">bindings = [int(d_input), int(d_output)]</span><br><span class="line"></span><br><span class="line">stream = cuda.Stream()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Transfer input data to device</span></span><br><span class="line">cuda.memcpy_htod_async(d_input, img, stream)</span><br><span class="line"><span class="comment"># Execute model </span></span><br><span class="line">context.enqueue(<span class="number">1</span>, bindings, stream.handle, <span class="keyword">None</span>)</span><br><span class="line"><span class="comment"># Transfer predictions back</span></span><br><span class="line">cuda.memcpy_dtoh_async(output, d_output, stream)</span><br><span class="line"><span class="comment"># Syncronize threads</span></span><br><span class="line">stream.synchronize()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"Test Case: "</span> + str(LABEL))</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Prediction: "</span> + str(np.argmax(output)))</span><br></pre></td></tr></table></figure>
<h3 id="TensorRT官方实例"><a href="#TensorRT官方实例" class="headerlink" title="TensorRT官方实例"></a>TensorRT官方实例</h3><p>资料在本仓库<code>src/tensorrt</code>目录下:    </p>
<ul>
<li><a href="https://github.com/aimuch/AiPlay/blob/master/src/tensorrt/tensorrt-4.0.1.6/caffe_to_tensorrt.ipynb" target="_blank" rel="noopener">TensorRT Caffe Engine</a>    </li>
<li><a href="https://github.com/aimuch/AiPlay/blob/master/src/tensorrt/tensorrt-4.0.1.6/tf_to_tensorrt.ipynb" target="_blank" rel="noopener">TensorRT Tensorflow Engine</a>    </li>
<li><a href="https://github.com/aimuch/AiPlay/blob/master/src/tensorrt/tensorrt-4.0.1.6/manually_construct_tensorrt_engine.ipynb" target="_blank" rel="noopener">Manually Construct Tensorrt Engine</a>    </li>
</ul>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><blockquote>
<p><a href="https://docs.nvidia.com/deeplearning/sdk/tensorrt-install-guide/index.html" target="_blank" rel="noopener">TensorRT官方安装指南</a>   </p>
</blockquote>
<hr>
<h1 id="安装caffe"><a href="#安装caffe" class="headerlink" title="安装caffe"></a>安装caffe</h1><h2 id="Python2下安装Cafe"><a href="#Python2下安装Cafe" class="headerlink" title="Python2下安装Cafe"></a>Python2下安装Cafe</h2><h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo apt-get install -y build-essential cmake git pkg-config</span><br><span class="line">sudo apt-get install -y libprotobuf-dev libleveldb-dev libsnappy-dev protobuf-compiler</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y libatlas-base-dev</span><br><span class="line">sudo apt-get install -y --no-install-recommends libboost-all-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y libgflags-dev libgoogle-glog-dev liblmdb-dev</span><br><span class="line">sudo apt-get -y install build-essential cmake git libgtk2.0-dev pkg-config python-dev python-numpy libdc1394-22 libdc1394-22-dev libjpeg-dev libpng12-dev libtiff5-dev libjasper-dev libavcodec-dev libavformat-dev libswscale-dev libxine2-dev libgstreamer0.10-dev libgstreamer-plugins-base0.10-dev libv4l-dev libtbb-dev libqt4-dev libfaac-dev libmp3lame-dev libopencore-amrnb-dev libopencore-amrwb-dev libtheora-dev libvorbis-dev libxvidcore-dev x264 v4l-utils unzip</span><br></pre></td></tr></table></figure>
<h3 id="配置CUDA-及-CUDNN"><a href="#配置CUDA-及-CUDNN" class="headerlink" title="配置CUDA 及 CUDNN"></a>配置<code>CUDA</code> 及 <code>CUDNN</code></h3><p>添加 CUDA 环境变量<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA</span></span><br><span class="line">export PATH=/usr/local/cuda/bin:$PATH  # cuda -&gt; /usr/local/cuda-9.0</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure></p>
<h3 id="安装OpenCV，方法同-安装OpenCV"><a href="#安装OpenCV，方法同-安装OpenCV" class="headerlink" title="安装OpenCV，方法同: 安装OpenCV"></a>安装<code>OpenCV</code>，方法同: <a href="#安装opencv">安装OpenCV</a></h3><h3 id="然后按照前面的方法屏蔽Anaconda"><a href="#然后按照前面的方法屏蔽Anaconda" class="headerlink" title="然后按照前面的方法屏蔽Anaconda"></a>然后按照前面的方法<a href="#屏蔽anaconda">屏蔽Anaconda</a></h3><h3 id="配置Caffe"><a href="#配置Caffe" class="headerlink" title="配置Caffe"></a>配置<code>Caffe</code></h3><p><strong>首先cd 到你要安装的路径下运行</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/BVLC/caffe.git</span><br></pre></td></tr></table></figure></p>
<p>这时候会出现一个 <code>caffe</code> 文件夹。命令行进入此文件夹，运行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cp Makefile.config.example Makefile.config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若无法拷贝则运行以下命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod 777 Makefile.config.example</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp Makefile.config.example Makefile.config</span></span><br><span class="line">```    </span><br><span class="line">此命令是将 `Makefile.config.example` 文件复制一份并更名为 `Makefile.config` ，复制一份的原因是编译 `caffe` 时需要的是 `Makefile.config` 文件，而Makefile.config.example 只是 `caffe` 给出的配置文件例子，不能用来编译 `caffe`。   </span><br><span class="line"></span><br><span class="line">**然后修改 Makefile.config 文件**，在 `caffe` 目录下打开该文件：</span><br><span class="line">```shell</span><br><span class="line">vim Makefile.config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者用右键选择gedit/vscode打开该文件</span></span><br></pre></td></tr></table></figure></p>
<h4 id="修改-Makefile-config-文件内容"><a href="#修改-Makefile-config-文件内容" class="headerlink" title="修改 Makefile.config 文件内容"></a>修改 <code>Makefile.config</code> 文件内容</h4><ul>
<li><p><strong>应用 cudnn</strong><br>将：<code>#USE_CUDNN := 1</code>修改为：<code>USE_CUDNN := 1</code>   </p>
</li>
<li><p><strong>应用 opencv 3 版本</strong><br>将：<code>#OPENCV_VERSION := 3</code>修改为：<code>OPENCV_VERSION := 3</code>   </p>
</li>
<li><strong>使用 python 接口</strong><br>将： <code>#WITH_PYTHON_LAYER := 1</code>修改为<code>WITH_PYTHON_LAYER := 1</code>   </li>
<li><p><strong>修改 python 路径</strong><br>将：   </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib</span><br></pre></td></tr></table></figure>
<p>修改为：         </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial</span><br></pre></td></tr></table></figure>
<p>此python路径为系统自带python的路径，假如想使用<code>Anaconda</code>的python的话需要在其他地方修改。</p>
</li>
<li><p><strong>去掉compute_20</strong><br>找到</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CUDA architecture setting: going with all of them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 6.0, comment the *_50 through *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 8.0, comment the *_60 and *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &gt;= 9.0, comment the *_20 and *_21 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line">CUDA_ARCH := -gencode arch=compute_20,code=sm_20 \</span><br><span class="line">            -gencode arch=compute_20,code=sm_21 \</span><br><span class="line">            -gencode arch=compute_30,code=sm_30 \</span><br><span class="line">            -gencode arch=compute_35,code=sm_35 \</span><br><span class="line">            -gencode arch=compute_50,code=sm_50 \</span><br><span class="line">            -gencode arch=compute_52,code=sm_52 \</span><br><span class="line">            -gencode arch=compute_60,code=sm_60 \</span><br><span class="line">            -gencode arch=compute_61,code=sm_61 \</span><br><span class="line">            -gencode arch=compute_61,code=compute_61</span><br></pre></td></tr></table></figure>
<p>改为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CUDA architecture setting: going with all of them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 6.0, comment the *_50 through *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 8.0, comment the *_60 and *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &gt;= 9.0, comment the *_20 and *_21 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line">CUDA_ARCH := -gencode arch=compute_30,code=sm_30 \</span><br><span class="line">            -gencode arch=compute_35,code=sm_35 \</span><br><span class="line">            -gencode arch=compute_50,code=sm_50 \</span><br><span class="line">            -gencode arch=compute_52,code=sm_52 \</span><br><span class="line">            -gencode arch=compute_60,code=sm_60 \</span><br><span class="line">            -gencode arch=compute_61,code=sm_61 \</span><br><span class="line">            -gencode arch=compute_61,code=compute_61</span><br></pre></td></tr></table></figure>
<p>由于<strong>CUDA 9.x +并不支持compute_20</strong>，此处不修改的话编译<code>caffe</code>时会报错：    </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc fatal  : Unsupported gpu architecture 'compute_20'</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="配置好的完整的Makefile-config文件"><a href="#配置好的完整的Makefile-config文件" class="headerlink" title="配置好的完整的Makefile.config文件"></a>配置好的完整的<code>Makefile.config</code>文件</h4><p>在caffe源码目录中修改后的完整<code>Makefile.config</code>文件，内容如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Refer to http://caffe.berkeleyvision.org/installation.html</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Contributions simplifying and improving our build system are welcome!</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cuDNN acceleration switch (uncomment to build with cuDNN).</span></span><br><span class="line">USE_CUDNN := 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU-only switch (uncomment to build without GPU support).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU_ONLY := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> uncomment to <span class="built_in">disable</span> IO dependencies and corresponding data layers</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_OPENCV := 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_LEVELDB := 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_LMDB := 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> uncomment to allow MDB_NOLOCK when reading LMDB files (only <span class="keyword">if</span> necessary)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">	You should not <span class="built_in">set</span> this flag <span class="keyword">if</span> you will be reading LMDBs with any</span></span><br><span class="line"><span class="meta">#</span><span class="bash">	possibility of simultaneous <span class="built_in">read</span> and write</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ALLOW_LMDB_NOLOCK := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment <span class="keyword">if</span> you<span class="string">'re using OpenCV 3</span></span></span><br><span class="line">OPENCV_VERSION := 3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To customize your choice of compiler, uncomment and <span class="built_in">set</span> the following.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> N.B. the default <span class="keyword">for</span> Linux is g++ and the default <span class="keyword">for</span> OSX is clang++</span></span><br><span class="line">CUSTOM_CXX := g++</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA directory contains bin/ and lib/ directories that we need.</span></span><br><span class="line">CUDA_DIR := /usr/local/cuda</span><br><span class="line"><span class="meta">#</span><span class="bash"> On Ubuntu 14.04, <span class="keyword">if</span> cuda tools are installed via</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">"sudo apt-get install nvidia-cuda-toolkit"</span> <span class="keyword">then</span> use this instead:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA_DIR := /usr</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA architecture setting: going with all of them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 6.0, comment the *_50 through *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 8.0, comment the *_60 and *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &gt;= 9.0, comment the *_20 and *_21 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line">CUDA_ARCH := -gencode arch=compute_30,code=sm_30 \</span><br><span class="line">            -gencode arch=compute_35,code=sm_35 \</span><br><span class="line">            -gencode arch=compute_50,code=sm_50 \</span><br><span class="line">            -gencode arch=compute_52,code=sm_52 \</span><br><span class="line">            -gencode arch=compute_60,code=sm_60 \</span><br><span class="line">            -gencode arch=compute_61,code=sm_61 \</span><br><span class="line">            -gencode arch=compute_61,code=compute_61</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS choice:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> atlas <span class="keyword">for</span> ATLAS (default)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mkl <span class="keyword">for</span> MKL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> open <span class="keyword">for</span> OpenBlas</span></span><br><span class="line">BLAS := atlas</span><br><span class="line"><span class="meta">#</span><span class="bash"> Custom (MKL/ATLAS/OpenBLAS) include and lib directories.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Leave commented to accept the defaults <span class="keyword">for</span> your choice of BLAS</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (<span class="built_in">which</span> should work)!</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := /path/to/your/blas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := /path/to/your/blas</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Homebrew puts openblas <span class="keyword">in</span> a directory that is not on the standard search path</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := $(shell brew --prefix openblas)/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := $(shell brew --prefix openblas)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is required only <span class="keyword">if</span> you will compile the matlab interface.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB directory should contain the mex binary <span class="keyword">in</span> /bin.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB_DIR := /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB_DIR := /Applications/MATLAB_R2012b.app</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE: this is required only <span class="keyword">if</span> you will compile the python interface.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> We need to be able to find Python.h and numpy/arrayobject.h.</span></span><br><span class="line">PYTHON_INCLUDE := /usr/include/python2.7 \</span><br><span class="line">                  /usr/lib/python2.7/dist-packages/numpy/core/include</span><br><span class="line"><span class="meta">#</span><span class="bash"> Anaconda Python distribution is quite popular. Include path:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify anaconda location, sometimes it<span class="string">'s in root.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ANACONDA_HOME := $(HOME)/anaconda</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE := $(ANACONDA_HOME)/include \</span></span><br><span class="line">    # $(ANACONDA_HOME)/include/python2.7 \</span><br><span class="line">    # $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to use Python 3 (default is Python 2)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_LIBRARIES := boost_python3 python3.5m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE := /usr/include/python3.5m \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 /usr/lib/python3.5/dist-packages/numpy/core/include</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> We need to be able to find libpythonX.X.so or .dylib.</span></span><br><span class="line">PYTHON_LIB := /usr/lib</span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_LIB := $(ANACONDA_HOME)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Homebrew installs numpy <span class="keyword">in</span> a non standard path (keg only)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE += $(dir $(shell python -c <span class="string">'import numpy.core; print(numpy.core.__file__)'</span>))/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_LIB += $(shell brew --prefix numpy)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to support layers written <span class="keyword">in</span> Python (will link against Python libs)</span></span><br><span class="line">WITH_PYTHON_LAYER := 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Whatever <span class="keyword">else</span> you find you need goes here.</span></span><br><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial/</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If Homebrew is installed at a non standard location (<span class="keyword">for</span> example your home directory) and you use it <span class="keyword">for</span> general dependencies</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> INCLUDE_DIRS += $(shell brew --prefix)/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LIBRARY_DIRS += $(shell brew --prefix)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NCCL acceleration switch (uncomment to build with NCCL)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://github.com/NVIDIA/nccl (last tested version: v1.2.3-1+cuda8.0)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_NCCL := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to use `pkg-config` to specify OpenCV library paths.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (Usually not necessary -- OpenCV libraries are normally installed <span class="keyword">in</span> one of the above <span class="variable">$LIBRARY_DIRS</span>.)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_PKG_CONFIG := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> N.B. both build and distribute <span class="built_in">dirs</span> are cleared on `make clean`</span></span><br><span class="line">BUILD_DIR := build</span><br><span class="line">DISTRIBUTE_DIR := distribute</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment <span class="keyword">for</span> debugging. Does not work on OSX due to https://github.com/BVLC/caffe/issues/171</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEBUG := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The ID of the GPU that <span class="string">'make runtest'</span> will use to run unit tests.</span></span><br><span class="line">TEST_GPUID := 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> pretty build (comment to see full commands)</span></span><br><span class="line">Q ?= @</span><br></pre></td></tr></table></figure></p>
<h4 id="修改caffe-目录下的Makefile文件"><a href="#修改caffe-目录下的Makefile文件" class="headerlink" title="修改caffe 目录下的Makefile文件"></a>修改<code>caffe 目录</code>下的<code>Makefile</code>文件</h4><p><em>修改的地方找起来比较困难的话可以复制到word里查找</em><br>将：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NVCCFLAGS +=-ccbin=$(CXX) -Xcompiler-fPIC $(COMMON_FLAGS)</span><br></pre></td></tr></table></figure></p>
<p>替换为：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NVCCFLAGS += -D_FORCE_INLINES -ccbin=$(CXX) -Xcompiler -fPIC $(COMMON_FLAGS)</span><br></pre></td></tr></table></figure></p>
<p>将：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBRARIES += glog gflags protobuf boost_system boost_filesystem <span class="keyword">m</span> hdf5_hl hdf5</span><br></pre></td></tr></table></figure></p>
<p>改为：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBRARIES += glog gflags protobuf boost_system boost_filesystem <span class="keyword">m</span> hdf5_serial_hl hdf5_serial</span><br></pre></td></tr></table></figure></p>
<p>至此caffe配置文件修改完毕，可以开始编译了。假如显卡不是feimi架构的可以输入如下命令防止出现<code>Unsupported gpu architecture &#39;compute_20&#39;</code>的问题：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -D CMAKE_BUILD_TYPE=RELEASE  -D CUDA_GENERATION=Kepler ..</span><br></pre></td></tr></table></figure></p>
<h3 id="编译安装Caffe"><a href="#编译安装Caffe" class="headerlink" title="编译安装Caffe"></a>编译安装<code>Caffe</code></h3><p>在 <code>caffe</code> 目录下执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd caffe</span><br><span class="line">make all -j $(($(nproc) + 1))</span><br><span class="line">make test -j $(($(nproc) + 1))</span><br><span class="line">make runtest -j $(($(nproc) + 1))</span><br><span class="line">make pycaffe -j $(($(nproc) + 1))</span><br></pre></td></tr></table></figure></p>
<p><code>runtest</code>之后成功成功的界面如下:<br><img src="/2019/03/17/搭建深度学习服务器环境/caffe_install.png" alt="png"></p>
<p><strong>添加<code>Caffe</code>环境变量</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export PYTHONPATH=~/caffe/python:$PYTHONPATH</span><br></pre></td></tr></table></figure></p>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p><strong>常见问题 1</strong><br>在caffe源码目录中修改<code>Makefile</code>文件中这一行如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBRARIES += glog gflags protobuf boost_system boost_filesystem m hdf5_serial_hl hdf5_serial</span><br></pre></td></tr></table></figure></p>
<p>上述中<code>Makefile.config</code>和<code>Makefile</code>文件都要添加<code>hdf5</code>相关选项，否则会提示以下错误：<br><img src="/2019/03/17/搭建深度学习服务器环境/caffe-error1.png" alt="hdf5报错">    </p>
<p><strong>常见问题 2</strong><br>在<code>python</code>中导入<code>caffe</code>库的时候会提示以下信息：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/python2.7/dist-packages/scipy/sparse/lil.py:19: RuntimeWarning: numpy.dtype </span><br><span class="line">size changed, may indicate binary incompatibility. Expected 96, got 88</span><br></pre></td></tr></table></figure></p>
<p><strong>解决方法</strong><br>将<code>numpy</code>降版本：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall numpy</span><br><span class="line">pip install numpy==1.14.5</span><br></pre></td></tr></table></figure></p>
<p><strong>常见问题 3</strong><br>导入<code>caffe</code>的时候还有一个<strong>错误</strong>:<br><img src="/2019/03/17/搭建深度学习服务器环境/caffe-error2.png" alt="导入caffe报错"><br>原因是我在<code>ubutnu</code>下用的<code>linuxbrew</code>安装的<code>Python2</code>设为默认<code>Python</code>了，然后<code>caffe</code>编译配置文件里用的是系统的<code>Python2</code>路径，导致系统自带的<code>Python</code>与<code>linuxbrew</code>安装的<code>Python</code>环境混乱。<br>解决方法是屏蔽掉<code>linuxbrew</code>环境。只用系统自带的<code>Python</code>，将<code>~/.profile</code>文件中的<code>eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)</code>这一行屏蔽:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> linuxbrew</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">eval</span> $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)</span></span><br></pre></td></tr></table></figure></p>
<p>然后重启电脑.     </p>
<p><strong>常见问题 4</strong><br><img src="/2019/03/17/搭建深度学习服务器环境/caffe-error3.png" alt="导入caffe报错"><br>导致上述原因是<code>pip2</code>同时存在于<code>/usr/bin/pip2</code>和<code>/usr/local/bin/pip2</code>两个地方:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看pip2位于哪里</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">where</span> pip2</span></span><br><span class="line">/usr/local/bin/pip2</span><br><span class="line">/usr/bin/pip2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前用到的pip2是哪一个</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">which</span> pip</span></span><br><span class="line">/usr/local/bin/pip</span><br></pre></td></tr></table></figure></p>
<p>解决方法是用<code>/usr/local/bin/pip2</code>安装<code>protobuf</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/pip2 install protobuf</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/37666241/importing-caffe-results-in-importerror-no-module-named-google-protobuf-interna" target="_blank" rel="noopener">Importing caffe results in ImportError: “No module named google.protobuf.internal”
</a><br>This is probably because you have two python environments in your machine, the one provided by your linux distribution(pip) and the other by the anaconda environment (/home/username/anaconda2/bin/pip).<br>Try installing protobuf for both environments to be sure<br><code>pip install protobuf</code><br><code>/home/username/anaconda2/bin/pip</code> install protobuf</p>
</blockquote>
<h2 id="Python3下安装Cafe"><a href="#Python3下安装Cafe" class="headerlink" title="Python3下安装Cafe"></a>Python3下安装Cafe</h2><h3 id="切换系统Python版本到Python3"><a href="#切换系统Python版本到Python3" class="headerlink" title="切换系统Python版本到Python3"></a>切换系统<code>Python</code>版本到<code>Python3</code></h3><p>将系统Python切换到Python3版本:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">which python3</span><br><span class="line">which python</span><br><span class="line">sudo rm /usr/bin/python # 删掉Python软连接</span><br><span class="line">sudo ln -s /usr/bin/python3 /usr/bin/python # 将Python3软连接到Python</span><br></pre></td></tr></table></figure></p>
<h3 id="装依赖库"><a href="#装依赖库" class="headerlink" title="装依赖库"></a>装依赖库</h3><blockquote>
<p><a href="#python2下安装cafe">同Python2.7安装依赖库</a>    </p>
</blockquote>
<h3 id="配置CUDA-及-CUDNN-1"><a href="#配置CUDA-及-CUDNN-1" class="headerlink" title="配置CUDA 及 CUDNN"></a>配置<code>CUDA</code> 及 <code>CUDNN</code></h3><blockquote>
<p><a href="#python2下安装cafe">同Python2.7配置CUDA以及CUDNN</a>    </p>
</blockquote>
<h3 id="pip-安装依赖模块"><a href="#pip-安装依赖模块" class="headerlink" title="pip 安装依赖模块"></a>pip 安装依赖模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install opencv-python==3.4.0.12 # OpenCV的Python版本要跟opencv源码安装的版本对应起来</span><br><span class="line">pip install protobuf</span><br></pre></td></tr></table></figure>
<h3 id="安装OpenCV，方法同-安装OpenCV-1"><a href="#安装OpenCV，方法同-安装OpenCV-1" class="headerlink" title="安装OpenCV，方法同: 安装OpenCV"></a>安装<code>OpenCV</code>，方法同: <a href="#安装opencv">安装OpenCV</a></h3><h3 id="然后按照前面的方法屏蔽Anaconda-1"><a href="#然后按照前面的方法屏蔽Anaconda-1" class="headerlink" title="然后按照前面的方法屏蔽Anaconda"></a>然后按照前面的方法<a href="#若需要将anaconda屏蔽">屏蔽Anaconda</a></h3><h3 id="配置Caffe-1"><a href="#配置Caffe-1" class="headerlink" title="配置Caffe"></a>配置<code>Caffe</code></h3><p><strong>首先cd 到你要安装的路径下运行</strong>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/BVLC/caffe.git</span><br></pre></td></tr></table></figure></p>
<p>这时候会出现一个 <code>caffe</code> 文件夹。命令行进入此文件夹，运行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cp Makefile.config.example Makefile.config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若无法拷贝则运行以下命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod 777 Makefile.config.example</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp Makefile.config.example Makefile.config</span></span><br><span class="line">```    </span><br><span class="line">此命令是将 `Makefile.config.example` 文件复制一份并更名为 `Makefile.config` ，复制一份的原因是编译 `caffe` 时需要的是 `Makefile.config` 文件，而Makefile.config.example 只是 `caffe` 给出的配置文件例子，不能用来编译 `caffe`。   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#### 然后修改 Makefile.config 文件**，在 `caffe` 目录下打开该文件</span></span></span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">vim Makefile.config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者用右键选择gedit/vscode打开该文件</span></span><br></pre></td></tr></table></figure></p>
<p>在<code>caffe</code>源码目录中修改<code>Makefile.config</code>内容如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Refer to http://caffe.berkeleyvision.org/installation.html</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Contributions simplifying and improving our build system are welcome!</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cuDNN acceleration switch (uncomment to build with cuDNN).</span></span><br><span class="line">USE_CUDNN := 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU-only switch (uncomment to build without GPU support).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU_ONLY := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> uncomment to <span class="built_in">disable</span> IO dependencies and corresponding data layers</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_OPENCV := 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_LEVELDB := 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_LMDB := 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> uncomment to allow MDB_NOLOCK when reading LMDB files (only <span class="keyword">if</span> necessary)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">	You should not <span class="built_in">set</span> this flag <span class="keyword">if</span> you will be reading LMDBs with any</span></span><br><span class="line"><span class="meta">#</span><span class="bash">	possibility of simultaneous <span class="built_in">read</span> and write</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ALLOW_LMDB_NOLOCK := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment <span class="keyword">if</span> you<span class="string">'re using OpenCV 3</span></span></span><br><span class="line">OPENCV_VERSION := 3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To customize your choice of compiler, uncomment and <span class="built_in">set</span> the following.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> N.B. the default <span class="keyword">for</span> Linux is g++ and the default <span class="keyword">for</span> OSX is clang++</span></span><br><span class="line">CUSTOM_CXX := g++</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA directory contains bin/ and lib/ directories that we need.</span></span><br><span class="line">CUDA_DIR := /usr/local/cuda</span><br><span class="line"><span class="meta">#</span><span class="bash"> On Ubuntu 14.04, <span class="keyword">if</span> cuda tools are installed via</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">"sudo apt-get install nvidia-cuda-toolkit"</span> <span class="keyword">then</span> use this instead:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA_DIR := /usr</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CUDA architecture setting: going with all of them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 6.0, comment the *_50 through *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &lt; 8.0, comment the *_60 and *_61 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For CUDA &gt;= 9.0, comment the *_20 and *_21 lines <span class="keyword">for</span> compatibility.</span></span><br><span class="line">CUDA_ARCH := -gencode arch=compute_30,code=sm_30 \</span><br><span class="line">             -gencode arch=compute_35,code=sm_35 \</span><br><span class="line">             -gencode arch=compute_50,code=sm_50 \</span><br><span class="line">             -gencode arch=compute_52,code=sm_52 \</span><br><span class="line">             -gencode arch=compute_60,code=sm_60 \</span><br><span class="line">             -gencode arch=compute_61,code=sm_61 \</span><br><span class="line">             -gencode arch=compute_61,code=compute_61</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS choice:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> atlas <span class="keyword">for</span> ATLAS (default)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mkl <span class="keyword">for</span> MKL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> open <span class="keyword">for</span> OpenBlas</span></span><br><span class="line">BLAS := atlas</span><br><span class="line"><span class="meta">#</span><span class="bash"> Custom (MKL/ATLAS/OpenBLAS) include and lib directories.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Leave commented to accept the defaults <span class="keyword">for</span> your choice of BLAS</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (<span class="built_in">which</span> should work)!</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := /path/to/your/blas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := /path/to/your/blas</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Homebrew puts openblas <span class="keyword">in</span> a directory that is not on the standard search path</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_INCLUDE := $(shell brew --prefix openblas)/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BLAS_LIB := $(shell brew --prefix openblas)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is required only <span class="keyword">if</span> you will compile the matlab interface.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB directory should contain the mex binary <span class="keyword">in</span> /bin.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB_DIR := /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MATLAB_DIR := /Applications/MATLAB_R2012b.app</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE: this is required only <span class="keyword">if</span> you will compile the python interface.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> We need to be able to find Python.h and numpy/arrayobject.h.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE := /usr/include/python2.7 \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                  /usr/lib/python2.7/dist-packages/numpy/core/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Anaconda Python distribution is quite popular. Include path:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Verify anaconda location, sometimes it<span class="string">'s in root.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ANACONDA_HOME := $(HOME)/anaconda</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE := $(ANACONDA_HOME)/include \</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> $(ANACONDA_HOME)/include/python2.7 \</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to use Python 3 (default is Python 2)</span></span><br><span class="line">PYTHON_LIBRARIES := boost_python3 python3.5m</span><br><span class="line">PYTHON_INCLUDE := /usr/include/python3.5m \</span><br><span class="line">                 /usr/lib/python3.5/dist-packages/numpy/core/include</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> We need to be able to find libpythonX.X.so or .dylib.</span></span><br><span class="line">PYTHON_LIB := /usr/lib</span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_LIB := $(ANACONDA_HOME)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Homebrew installs numpy <span class="keyword">in</span> a non standard path (keg only)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_INCLUDE += $(dir $(shell python -c <span class="string">'import numpy.core; print(numpy.core.__file__)'</span>))/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PYTHON_LIB += $(shell brew --prefix numpy)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to support layers written <span class="keyword">in</span> Python (will link against Python libs)</span></span><br><span class="line">WITH_PYTHON_LAYER := 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Whatever <span class="keyword">else</span> you find you need goes here.</span></span><br><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial/</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If Homebrew is installed at a non standard location (<span class="keyword">for</span> example your home directory) and you use it <span class="keyword">for</span> general dependencies</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> INCLUDE_DIRS += $(shell brew --prefix)/include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LIBRARY_DIRS += $(shell brew --prefix)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NCCL acceleration switch (uncomment to build with NCCL)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://github.com/NVIDIA/nccl (last tested version: v1.2.3-1+cuda8.0)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_NCCL := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to use `pkg-config` to specify OpenCV library paths.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (Usually not necessary -- OpenCV libraries are normally installed <span class="keyword">in</span> one of the above <span class="variable">$LIBRARY_DIRS</span>.)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> USE_PKG_CONFIG := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> N.B. both build and distribute <span class="built_in">dirs</span> are cleared on `make clean`</span></span><br><span class="line">BUILD_DIR := build</span><br><span class="line">DISTRIBUTE_DIR := distribute</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment <span class="keyword">for</span> debugging. Does not work on OSX due to https://github.com/BVLC/caffe/issues/171</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEBUG := 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The ID of the GPU that <span class="string">'make runtest'</span> will use to run unit tests.</span></span><br><span class="line">TEST_GPUID := 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> pretty build (comment to see full commands)</span></span><br><span class="line">Q ?= @</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#### 修改` caffe 目录`下的` Makefile `文件</span></span></span><br><span class="line"></span><br><span class="line">*修改的地方找起来比较困难的话可以复制到word里查找*    </span><br><span class="line">将：   </span><br><span class="line">```shell</span><br><span class="line">NVCCFLAGS +=-ccbin=$(CXX) -Xcompiler-fPIC $(COMMON_FLAGS)</span><br></pre></td></tr></table></figure></p>
<p>替换为：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NVCCFLAGS += -D_FORCE_INLINES -ccbin=$(CXX) -Xcompiler -fPIC $(COMMON_FLAGS)</span><br></pre></td></tr></table></figure></p>
<p>将：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBRARIES += glog gflags protobuf boost_system boost_filesystem <span class="keyword">m</span> hdf5_hl hdf5</span><br></pre></td></tr></table></figure></p>
<p>改为：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBRARIES += glog gflags protobuf boost_system boost_filesystem <span class="keyword">m</span> hdf5_serial_hl hdf5_serial</span><br></pre></td></tr></table></figure></p>
<p>至此caffe配置文件修改完毕，可以开始编译了。假如显卡不是feimi架构的可以输入如下命令防止出现<code>Unsupported gpu architecture &#39;compute_20&#39;</code>的问题：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -D CMAKE_BUILD_TYPE=RELEASE  -D CUDA_GENERATION=Kepler ..</span><br></pre></td></tr></table></figure></p>
<h3 id="编译安装Caffe-1"><a href="#编译安装Caffe-1" class="headerlink" title="编译安装Caffe"></a>编译安装<code>Caffe</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd caffe</span><br><span class="line">make all -j $(($(nproc) + 1))</span><br><span class="line">make test -j $(($(nproc) + 1))</span><br><span class="line">make runtest -j $(($(nproc) + 1))</span><br><span class="line">make pycaffe -j $(($(nproc) + 1))</span><br></pre></td></tr></table></figure>
<p><strong>添加<code>Caffe</code>环境变量</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export PYTHONPATH=~/caffe/python:$PYTHONPATH</span><br></pre></td></tr></table></figure></p>
<h3 id="常见问题-1"><a href="#常见问题-1" class="headerlink" title="常见问题"></a>常见问题</h3><p><strong>常见问题 1</strong><br><img src="/2019/03/17/搭建深度学习服务器环境/caffe-error4.png" alt="编译caffe报错"><br><strong>解决方法</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/madler/zlib</span><br><span class="line">cd path/to/zlib</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install  # you may add 'sudo'</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">**常见问题 2**    </span><br><span class="line">&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=Violet&gt;protoc: error while loading shared libraries: libprotoc.so.10: cannot open shared object file: No such file or directory&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">**解决：**</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/lib</span><br></pre></td></tr></table></figure></p>
<p><strong>常见问题 3</strong>    </p>
<table><tr><td bgcolor="Violet">/sbin/ldconfig.real: /usr/local/cuda-9.0/lib64/libcudnn.so.5 不是符号连接</td></tr></table>

<p><strong>解决：</strong><br>在sudo ldconfig时遇到<code>usr/local/cuda-9.0/lib64/libcudnn.so.5</code>不是符号连接的问题，解决办法也很简单，重新建立链接并删除原链接</p>
<p>首先找到<code>usr/local/cuda-8.0/lib64/</code>目录，搜索<code>libcudnn</code>然后发现两个文件<code>libcudnn.so.5</code>和<code>libcudnn.so.5.0.5</code>理论上只有一个<code>libcudnn.so.5.0.5</code></p>
<p>终端执行:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/local/cuda-9.0/lib64/libcudnn.so.5.0.5 /usr/local/cuda-9.0/lib64/libcudnn.so.5</span><br></pre></td></tr></table></figure></p>
<p>再<code>sudo ldconfig</code>时就可以了，这时候会发现usr/local/cuda-9.0/lib64/目录下只有<code>libcudnn.so.5.0.5</code>文件了，<code>libcudnn.so.5</code>消失了。</p>
<p><strong>常见问题 4</strong>    </p>
<table><tr><td bgcolor="Violet">.build_release/tools/caffe: error while loading shared libraries: libhdf5.so.10: cannot open shared object file: No such file    or directory</td></tr></table>

<p><strong>解决：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "export LD_LIBRARY_PATH=/home/abc/anaconda2/lib:$LD_LIBRARY_PATH" &gt;&gt;~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p><strong>常见问题 5</strong>    </p>
<table><tr><td bgcolor="Violet">错误：python/caffe/_caffe.cpp:1:52:致命错误：Python.h：没有那个文件或目录<br>编译中断。<br>make:***<br>[python/caffe/_caffe.so]错误1</td></tr></table>

<p><strong>解决：</strong><br>执行：<code>sudo find / -name &#39;Python.h&#39;</code>找到他的路径，<br>在<code>Makefile.config</code>的PYTHON_INCLUDE加上<code>/home/abc/anaconda2/include/python2.7</code>（路径是自己的）    </p>
<p><strong>常见问题 6</strong>    </p>
<table><tr><td bgcolor="Violet">错误：import caffe时：ImportError:No module named skimage.io</td></tr></table>

<p><strong>解决：</strong><br>可能是我们没有安装所谓的skimage.io模块，所以可以用以下的命令来安装：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scikit-image  # you may need use sudo</span><br></pre></td></tr></table></figure></p>
<p><strong>常见问题 7</strong>    </p>
<table><tr><td bgcolor="Violet"><br>import caffe<br>Traceback(most recent call last):<br>File”<stdin>“, line 1, in <module><br>ImportError:No module named caffe</module></stdin></td></tr></table>

<p><strong>解决：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo'export PATH="/home/andy/caffe/python:$PATH"' &gt;&gt;~/.bashrc</span><br><span class="line">source~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>关掉终端，重新进入。   </p>
<hr>
<h1 id="安装protobuf"><a href="#安装protobuf" class="headerlink" title="安装protobuf"></a>安装protobuf</h1><h2 id="protobuf是什么"><a href="#protobuf是什么" class="headerlink" title="protobuf是什么"></a>protobuf是什么</h2><p>protobuf（Protocol Buffer）它是google提供的一个开源库，是一种语言无关、平台无关、扩展性好的用于通信协议、数据存储的结构化数据串行化方法。有如XML，不过它更小、更快、也更简单。你可以定义自己的数据结构，然后使用代码生成器生成的代码来读写这个数据结构。</p>
<h2 id="protobuf-c-是什么"><a href="#protobuf-c-是什么" class="headerlink" title="protobuf-c 是什么"></a>protobuf-c 是什么</h2><p>由于Protocol Buffer原生没有对C的支持，只能使用protobuf-c这个第三方库，它提供了支持C语言的API接口。</p>
<p>下面先安装protobuf，然后安装protobuf-c 。   </p>
<h2 id="安装protocbuf"><a href="#安装protocbuf" class="headerlink" title="安装protocbuf"></a>安装protocbuf</h2><h3 id="下载源码安装包"><a href="#下载源码安装包" class="headerlink" title="下载源码安装包"></a>下载源码安装包</h3><p><a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">https://developers.google.com/protocol-buffers/</a><br><img src="/2019/03/17/搭建深度学习服务器环境/img3.png" alt="下载界面"></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/img4.png" alt="GitHub界面"><br>在release下可以找到所有的版本，我这里用的是2.4.1版本，复制protobuf-2.4.1.tar.gz的链接然后用wget命令下载。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/google/protobuf/releases/download/v2.4.1/protobuf-2.4.1.tar.gz</span><br></pre></td></tr></table></figure></p>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf protobuf-2.4.1.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="编译-安装"><a href="#编译-安装" class="headerlink" title="编译/安装"></a>编译/安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd protobuf-2.4.1</span><br></pre></td></tr></table></figure>
<p>（可以参考README思路来做。）<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make check  #(check结果可能会有错误，但不用管她，因为暂时那些功能用不到)</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p>
<p>（完了之后会在 /usr/local/bin 目录下生成一个可执行文件 protoc）</p>
<h3 id="检查安装是否成功"><a href="#检查安装是否成功" class="headerlink" title="检查安装是否成功"></a>检查安装是否成功</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --version</span><br></pre></td></tr></table></figure>
<p>如果成功，则会输出版本号信息。如果有问题，则会输出错误内容。</p>
<h3 id="错误及解决方法"><a href="#错误及解决方法" class="headerlink" title="错误及解决方法"></a>错误及解决方法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc: error while loading shared libraries: libprotoc.so.8: cannot open shared</span><br></pre></td></tr></table></figure>
<p><strong>错误原因</strong>：<br>protobuf的默认安装路径是/usr/local/lib，而/usr/local/lib 不在Ubuntu体系默认的 LD_LIBRARY_PATH 里，所以就找不到该lib<br>解决方法：<br>1). 创建文件<code>sudo gedit /etc/ld.so.conf.d/libprotobuf.conf</code>，在该文件中输入如下内容：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib</span><br></pre></td></tr></table></figure></p>
<p>2). 执行命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></p>
<p>这时，再运行protoc –version 就可以正常看到版本号了</p>
<h2 id="安装protobuf-c"><a href="#安装protobuf-c" class="headerlink" title="安装protobuf-c"></a>安装protobuf-c</h2><p>（这里使用的是protobuf-c-0.15版本，较高版本的安装类似）</p>
<p>进入下面的链接<br><a href="https://code.google.com/p/protobuf-c/" target="_blank" rel="noopener">https://code.google.com/p/protobuf-c/</a><br>进入Downloads界面<br><img src="/2019/03/17/搭建深度学习服务器环境/img5.png" alt="下载界面"></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/img6.png" alt="下载界面"></p>
<p><img src="/2019/03/17/搭建深度学习服务器环境/img7.png" alt="下载界面"></p>
<p>不知怎地，wget无法下载途中的<code>protobuf-c-0.15.tar.gz</code>文件。</p>
<p>怎么办呢，我们可以点击上图中的Export to GitHub，将代码导入到GitHub（当然你得有并登录自己的github账号），不过只有源码，没有release版。我们先wget下载源码，解包。由于是源码，所以没有configure文件，但是可以通过执行<code>autogen.sh</code>来生成configure文件，之后的操作就和安装protobuf类似了，这里就不细说了。<br>安装完成后会在<code>/usr/local/bin</code>目录下便会生成一个可执行文件 protoc-c</p>
<p>在安装完protobuf-c后，我们来检验一下protobuf-c是否安装成功。到 protobuf-c-0.15/src/test 目录下，执行如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc-c --c_out=. test.proto</span><br></pre></td></tr></table></figure></p>
<p>（c_out 标志是用来指定编译后所生成文件的输出路径，这里c_out指定的是当前目录。）<br>如果在c_out指定目录下能够生成 test.pb-c.c 和 test.pb-c.h 这两个文件则说明安装成功了。</p>
<h2 id="Protobuf的使用示例"><a href="#Protobuf的使用示例" class="headerlink" title="Protobuf的使用示例"></a>Protobuf的使用示例</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch person.proto</span><br></pre></td></tr></table></figure>
<p>输入如下内容：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message Person &#123;</span><br><span class="line">  required string name = 1;</span><br><span class="line">  required int32 id = 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译.proto文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc-c --c_out=. person.proto</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch main.c</span><br></pre></td></tr></table></figure>
<p>输入如下代码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"person.pb-c.h"</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个Person元素，并往其中存入数据</span></span><br><span class="line">    Person person = PERSON__INIT;</span><br><span class="line">    person.id = <span class="number">1314</span>;</span><br><span class="line">    person.name = <span class="string">"lily"</span>;  <span class="comment">// 字符串 lily 位于常量区</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"id = %d\n"</span>, person.id);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"name = %s\n"</span>, person.name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打包</span></span><br><span class="line">    <span class="keyword">int</span> len = person__get_packed_size(&amp;person);</span><br><span class="line">    <span class="comment">//printf("len = %d\n", len);</span></span><br><span class="line">    <span class="keyword">void</span> *sendpack = <span class="built_in">malloc</span>(len);</span><br><span class="line">    person__pack(&amp;person, sendpack);</span><br><span class="line">        <span class="comment">// sendpack是打好的包，可以通过socket通讯将其发送出去。</span></span><br><span class="line">    <span class="comment">//（这里主要讲protobuf，就不发送了）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接收端解包</span></span><br><span class="line">    Person *recvbuf = person__unpack(<span class="literal">NULL</span>, len, sendpack);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"id = %d\n"</span>, recvbuf-&gt;id);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"name = %s\n"</span>, recvbuf-&gt;name);</span><br><span class="line">    <span class="comment">// 包用完了要释放</span></span><br><span class="line">    person__free_unpacked(recvbuf, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">free</span>(sendpack);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc person.pb-c.c main.c -lprotobuf-c</span><br></pre></td></tr></table></figure></p>
<p>执行<code>./a.out</code>，输出结果如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id = 1314</span><br><span class="line">name = lily</span><br><span class="line">id = 1314</span><br><span class="line">name = lily</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="Linux-MATLAB安装"><a href="#Linux-MATLAB安装" class="headerlink" title="Linux MATLAB安装"></a>Linux MATLAB安装</h1><h2 id="安装前准备工作"><a href="#安装前准备工作" class="headerlink" title="安装前准备工作"></a>安装前准备工作</h2><p>下载<code>MATLAB for Linux</code>文件, 这里用到的是<a href="https://blog.csdn.net/m0_37775034/article/details/80876362" target="_blank" rel="noopener">@晨曦月下</a>提供的百度网盘链接下载:    </p>
<blockquote>
<p>链接: <a href="https://pan.baidu.com/s/1W6jWkaXEMpMUEmIl8qmRwg" target="_blank" rel="noopener">https://pan.baidu.com/s/1W6jWkaXEMpMUEmIl8qmRwg</a><br>密码: igx6    </p>
</blockquote>
<p>进入下载后的文件夹(假如下载后的文件放在了<code>/home/Download/</code>, 解压破解文件<code>Matlab2018aLinux64Crack.tar.gz</code>文件, 创建一个文件夹<code>Crack</code>来放置解压后的文件:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Download</span><br><span class="line">sudo mkdir Crack</span><br></pre></td></tr></table></figure></p>
<p>解压文件:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Download</span><br><span class="line">tar -xvf Matlab2018aLinux64Crack.tar.gz -C Crack</span><br></pre></td></tr></table></figure></p>
<p>在<code>/mnt</code>中创建一个文件夹用来挂载<code>R2018a_glnxa64_dvd1.iso</code>和<code>R2018a_glnxa64_dvd2.iso</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt</span><br><span class="line">sudo mkdir iso</span><br></pre></td></tr></table></figure></p>
<p>先挂载<code>R2018a_glnxa64_dvd1.iso</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">sudo mount -t auto -o loop R2018a_glnxa64_dvd1.iso /mnt/iso</span><br></pre></td></tr></table></figure></p>
<p>如果这个时候提示<code>/mnt/iso: WARNING:device write-protected, mounted read-only</code>,那就修改下<code>/mnt</code>的权限:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br><span class="line">sudo chmod 755 mnt</span><br></pre></td></tr></table></figure></p>
<h2 id="Matlab安装过程"><a href="#Matlab安装过程" class="headerlink" title="Matlab安装过程"></a>Matlab安装过程</h2><p>安装开始，从挂载的文件夹<code>iso</code>中:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">sudo ./mnt/iso/install</span><br></pre></td></tr></table></figure></p>
<ol>
<li>选择 <code>Use a File Installation Key</code>:<br><img src="/2019/03/17/搭建深度学习服务器环境/matlab1.png" alt="matlab1">     </li>
<li>选择<code>Yes</code>,同意条约:<br><img src="/2019/03/17/搭建深度学习服务器环境/matlab2.png" alt="matlab2">     </li>
<li>选择默认安装目录,默认放在<code>/usr/local</code>中</li>
<li>选择<code>I have the File Installation Key for my license</code>,输入:<br> <code>09806-07443-53955-64350-21751-41297</code></li>
<li><p>安装到某个进度会提示插入<code>iso2</code>,这个时候挂载<code>R2018a_glnxa64_dvd2.iso</code></p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">sudo mount -t auto -o loop R2018a_glnxa64_dvd2.iso /mnt/iso</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后安装完成选择<code>finsh</code></p>
</li>
</ol>
<h2 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h2><ol>
<li><p>复制破解文件<code>Crack</code>中<code>license_standalone.lic</code>到安装目录中</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Crack</span><br><span class="line">sudo cp license_standalone.lic /usr/loca/MATLAB/R2018a/licenses</span><br></pre></td></tr></table></figure>
</li>
<li><p>复制<code>Crack</code>中的<code>R2018a</code>到<code>安装目录</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Crack</span><br><span class="line">sudo cp -r R2018a /usr/local/MATLAB</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>至此激活完成!    </p>
<p><strong>收拾残局</strong>, 取消挂载,删除文件:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo umunt /mnt/iso</span><br><span class="line">cd /mnt</span><br><span class="line">sudo rmdir iso</span><br></pre></td></tr></table></figure></p>
<h2 id="Matlab设置"><a href="#Matlab设置" class="headerlink" title="Matlab设置"></a>Matlab设置</h2><p>创建命令方便在任何终端都可以打开<code>matlab</code>,采用软链接的方式在<code>/usr/local/bin</code>中创建启动命令<code>matlab</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/lcoal/bin</span><br><span class="line">sudo ln -s /usr/local/MATLAB/R2018a/bin/matlab matlab</span><br></pre></td></tr></table></figure></p>
<p><strong>参考资料</strong>    </p>
<blockquote>
<p><a href="https://blog.csdn.net/m0_37775034/article/details/80876362" target="_blank" rel="noopener">linux安装MATLAB R2018a步骤</a>    </p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  
    <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Andy Liu">
  
  <p class="site-author-name" itemprop="name">Andy Liu</p>
  <div class="site-description motion-element" itemprop="description">Engineer. Runner. Music</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>







  <div class="links-of-author motion-element">
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://github.com/aimuch" title="GitHub &rarr; https://github.com/aimuch" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="mailto:liuvay@gmail.com" title="E-Mail &rarr; mailto:liuvay@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://weibo.com/207896500" title="Weibo &rarr; https://weibo.com/207896500" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://twitter.com/liugreat" title="Twitter &rarr; https://twitter.com/liugreat" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://stackoverflow.com/aimuch" title="StackOverflow &rarr; https://stackoverflow.com/aimuch" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://instagram.com/liugreat" title="Instagram &rarr; https://instagram.com/liugreat" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
      </span>
    
  </div>







          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andy Liu</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  


























<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
